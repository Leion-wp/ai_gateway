(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.plugins,n=window.wp.editPost,l=window.wp.components,o=window.wp.element,r=window.wp.data,c=window.wp.blocks,i=window.wp.apiFetch;var s=e.n(i);const u=window.wp.blockEditor,g=window.wp.i18n,p=window.AIGatewaySettings||{restUrl:"",nonce:"",agents:[]};p.nonce&&s().use(s().createNonceMiddleware(p.nonce));const d=[{key:"rewrite",label:(0,g.__)("Rewrite","ai-gateway"),instruction:(0,g.__)("Rewrite the text to be clearer and more engaging.","ai-gateway")},{key:"seo",label:(0,g.__)("SEO","ai-gateway"),instruction:(0,g.__)("Optimize the content for SEO while keeping a natural tone.","ai-gateway")},{key:"summarize",label:(0,g.__)("Summarize","ai-gateway"),instruction:(0,g.__)("Summarize the content in a few bullet points.","ai-gateway")},{key:"outline",label:(0,g.__)("Outline","ai-gateway"),instruction:(0,g.__)("Generate a structured outline for this article.","ai-gateway")}],m=e=>String(e||"").replace(/<[^>]+>/g,"").trim(),_=e=>{const t=e.name.replace("core/",""),a=m(e.attributes?.content||e.attributes?.title||"");return a?`${t}: ${a.slice(0,40)}`:t},y=e=>{const t=(0,r.select)("core/block-editor").getSelectedBlock();if(t){const a=(0,r.select)("core/block-editor").getBlockIndex(t.clientId);(0,r.dispatch)("core/block-editor").insertBlocks(e,a+1)}else(0,r.dispatch)("core/block-editor").insertBlocks(e)},h=(e,t)=>(0,c.createBlock)("core/buttons",{},[(0,c.createBlock)("core/button",{text:e,url:t})]);(0,a.registerPlugin)("ai-gateway-plugin",{render:function(){const[e,a]=(0,o.useState)(p.agents||[]),[i,w]=(0,o.useState)(p.agents?.[0]?.id||0),[k,B]=(0,o.useState)(""),[b,v]=(0,o.useState)({}),[S,E]=(0,o.useState)(""),[C,f]=(0,o.useState)(""),[x,T]=(0,o.useState)(!1),[O,A]=(0,o.useState)(!1),[P,I]=(0,o.useState)(""),F=(0,r.useSelect)(e=>e("core/block-editor").getBlocks(),[]),R=(0,r.useSelect)(e=>e("core/block-editor").getSelectedBlockClientId(),[]),[M,U]=(0,o.useState)(R||""),[q,L]=(0,o.useState)(""),[Q,G]=(0,o.useState)(""),[N,W]=(0,o.useState)(""),[j,z]=(0,o.useState)(""),[D,H]=(0,o.useState)(""),[$,J]=(0,o.useState)("landing"),[K,V]=(0,o.useState)(""),[X,Y]=(0,o.useState)("Get Started"),[Z,ee]=(0,o.useState)("Ready to launch?"),[te,ae]=(0,o.useState)("Contact"),[ne,le]=(0,o.useState)("#"),[oe,re]=(0,o.useState)(""),[ce,ie]=(0,o.useState)(""),[se,ue]=(0,o.useState)(!1),[ge,pe]=(0,o.useState)("Hero Title"),[de,me]=(0,o.useState)("Short supporting copy goes here."),[_e,ye]=(0,o.useState)("Learn more"),[he,we]=(0,o.useState)("#"),[ke,Be]=(0,o.useState)(null),be=(0,o.useMemo)(()=>e.find(e=>e.id===i),[e,i]),ve=(0,o.useMemo)(()=>F.find(e=>e.clientId===M),[F,M]),Se=be?.input_schema||[],Ee=be?.output_mode||"text",Ce=be?.tools||["smart_edit","outline_sections","page_template","faq_builder","cta_builder","quick_palette","media_insert","hero_section"],fe=e=>Ce.includes(e),xe=()=>{const e={};Se.forEach(t=>{e[t]=""}),v(e)};(0,o.useEffect)(()=>{if(e.length)return;let t=!0;return(async()=>{A(!0);try{const e=await s()({path:"/ai/v1/agents?enabled=1",method:"GET"});if(!t)return;const n=Array.isArray(e)?e:[];a(n),w(n[0]?.id||0)}catch(e){t&&I(e.message||"Failed to load agents.")}finally{t&&A(!1)}})(),()=>{t=!1}},[e.length]),(0,o.useEffect)(()=>{xe()},[i]),(0,o.useEffect)(()=>{R&&R!==M&&U(R)},[R,M]),(0,o.useEffect)(()=>{if(!ve)return void L("");const e=ve.attributes?.content||ve.attributes?.title||"";L(m(e))},[ve]);const Te=e.map(e=>({label:e.name,value:e.id})),Oe=F.map(e=>({label:_(e),value:e.clientId}));return(0,t.createElement)(n.PluginSidebar,{name:"ai-gateway",title:(0,g.__)("AI Agent","ai-gateway")},(0,t.createElement)(l.PanelBody,{title:(0,g.__)("AI Assistant","ai-gateway")},O&&(0,t.createElement)(l.Spinner,null),P&&(0,t.createElement)(l.Notice,{status:"error",isDismissible:!1},P),(0,t.createElement)(l.SelectControl,{label:(0,g.__)("Agent","ai-gateway"),value:i,options:Te,onChange:e=>w(Number(e))}),(0,t.createElement)(l.TextareaControl,{label:(0,g.__)("Instruction","ai-gateway"),value:k,onChange:B}),(0,t.createElement)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"12px"}},d.map(e=>(0,t.createElement)(l.Button,{key:e.key,variant:"secondary",onClick:()=>(e=>{B(e.instruction),e.inputs&&v(t=>({...t,...e.inputs}))})(e)},e.label))),Se.map(e=>(0,t.createElement)(l.TextControl,{key:e,label:e,value:b[e]||"",onChange:t=>((e,t)=>{v(a=>({...a,[e]:t}))})(e,t)})),(0,t.createElement)("div",{style:{display:"flex",gap:"8px",marginTop:"12px"}},(0,t.createElement)(l.Button,{variant:"primary",isBusy:x,onClick:async()=>{if(i){T(!0),I(""),f(""),E((0,g.__)("Running...","ai-gateway"));try{const e=await s()({path:"/ai/v1/run",method:"POST",data:{agent_id:i,instruction:k,inputs:b}});e?.error?(I(e.error),E("")):(E(e?.mcp_response||e?.ollama_response||""),f(e?.mcp_meta||""))}catch(e){I(e.message||"Unknown error."),E("")}finally{T(!1)}}else I("No agent selected.")}},(0,g.__)("Generate","ai-gateway")),(0,t.createElement)(l.Button,{variant:"secondary",onClick:()=>{if(!S)return;if("blocks"===Ee){try{const e=JSON.parse(S),t=(e=>{const t=e=>{if(!e||!e.name)return null;const a=(e.innerBlocks||[]).map(t).filter(Boolean);return(0,c.createBlock)(e.name,e.attributes||{},a)};return e.map(t).filter(Boolean)})(Array.isArray(e)?e:e.blocks||[]);t.length&&y(t)}catch(e){I(e.message||"Failed to parse blocks.")}return}const e=(0,r.select)("core/block-editor").getSelectedBlock();e&&Object.prototype.hasOwnProperty.call(e.attributes,"content")?(0,r.dispatch)("core/block-editor").updateBlockAttributes(e.clientId,{content:S}):y([(0,c.createBlock)("core/paragraph",{content:S})])}},(0,g.__)("Insert","ai-gateway")),(0,t.createElement)(l.Button,{variant:"tertiary",onClick:xe},(0,g.__)("Reset","ai-gateway"))),(0,t.createElement)(l.TextareaControl,{label:(0,g.__)("Result","ai-gateway"),value:S,onChange:E,help:C})),fe("smart_edit")&&(0,t.createElement)(l.PanelBody,{title:(0,g.__)("Smart Edit","ai-gateway"),initialOpen:!1},j&&(0,t.createElement)(l.Notice,{status:"error",isDismissible:!1},j),(0,t.createElement)(l.SelectControl,{label:(0,g.__)("Target block","ai-gateway"),value:M,options:Oe,onChange:e=>U(e)}),(0,t.createElement)(l.TextareaControl,{label:(0,g.__)("Block text","ai-gateway"),value:q,onChange:L}),(0,t.createElement)(l.TextControl,{label:(0,g.__)("Text color (hex)","ai-gateway"),value:Q,onChange:G}),(0,t.createElement)(l.TextControl,{label:(0,g.__)("Background color (hex)","ai-gateway"),value:N,onChange:W}),(0,t.createElement)(l.Button,{variant:"primary",onClick:()=>{if(!ve)return void z("Select a block first.");const e={...ve.attributes};if(Object.prototype.hasOwnProperty.call(e,"content"))e.content=q;else{if(!Object.prototype.hasOwnProperty.call(e,"title"))return void z("Selected block has no editable text.");e.title=q}const t={...e.style||{}};Q&&(t.color={...t.color||{},text:Q}),N&&(t.color={...t.color||{},background:N}),(Q||N)&&(e.style=t),(0,r.dispatch)("core/block-editor").updateBlockAttributes(ve.clientId,e),z("")}},(0,g.__)("Apply changes","ai-gateway"))),fe("outline_sections")&&(0,t.createElement)(l.PanelBody,{title:(0,g.__)("Outline to Sections","ai-gateway"),initialOpen:!1},(0,t.createElement)(l.TextareaControl,{label:(0,g.__)("Outline (one per line)","ai-gateway"),value:D,onChange:H}),(0,t.createElement)(l.Button,{variant:"primary",onClick:()=>{const e=D.split("\n").map(e=>e.trim()).filter(Boolean);if(!e.length)return;const t=[];e.forEach(e=>{let a=2,n=e;e.startsWith("### ")?(a=3,n=e.slice(4)):e.startsWith("## ")?(a=2,n=e.slice(3)):e.startsWith("# ")&&(a=2,n=e.slice(2)),t.push((0,c.createBlock)("core/heading",{level:a,content:n})),t.push((0,c.createBlock)("core/paragraph",{content:""}))}),y(t)}},(0,g.__)("Insert sections","ai-gateway"))),fe("page_template")&&(0,t.createElement)(l.PanelBody,{title:(0,g.__)("Page Template","ai-gateway"),initialOpen:!1},(0,t.createElement)(l.SelectControl,{label:(0,g.__)("Template","ai-gateway"),value:$,options:[{label:"Landing",value:"landing"},{label:"Blog",value:"blog"},{label:"Service",value:"service"}],onChange:J}),(0,t.createElement)(l.Button,{variant:"primary",onClick:()=>{var e;y("landing"===(e=$)?[(0,c.createBlock)("core/heading",{level:1,content:"Landing Page Title"}),(0,c.createBlock)("core/paragraph",{content:"Short value proposition goes here."}),(0,c.createBlock)("core/columns",{},[(0,c.createBlock)("core/column",{},[(0,c.createBlock)("core/heading",{level:3,content:"Feature One"}),(0,c.createBlock)("core/paragraph",{content:"Feature description."})]),(0,c.createBlock)("core/column",{},[(0,c.createBlock)("core/heading",{level:3,content:"Feature Two"}),(0,c.createBlock)("core/paragraph",{content:"Feature description."})])]),h("Get Started","#")]:"blog"===e?[(0,c.createBlock)("core/heading",{level:1,content:"Blog Post Title"}),(0,c.createBlock)("core/paragraph",{content:"Intro paragraph."}),(0,c.createBlock)("core/heading",{level:2,content:"Section One"}),(0,c.createBlock)("core/paragraph",{content:"Section content."}),(0,c.createBlock)("core/heading",{level:2,content:"Section Two"}),(0,c.createBlock)("core/paragraph",{content:"Section content."})]:[(0,c.createBlock)("core/heading",{level:1,content:"Service Page"}),(0,c.createBlock)("core/paragraph",{content:"Service overview."}),(0,c.createBlock)("core/heading",{level:2,content:"Benefits"}),(0,c.createBlock)("core/list",{values:"<li>Benefit one</li><li>Benefit two</li>"}),h("Contact Us","#")])}},(0,g.__)("Insert template","ai-gateway"))),fe("faq_builder")&&(0,t.createElement)(l.PanelBody,{title:(0,g.__)("FAQ Builder","ai-gateway"),initialOpen:!1},(0,t.createElement)(l.TextareaControl,{label:(0,g.__)("FAQ input (Q:/A:)","ai-gateway"),value:K,onChange:V}),(0,t.createElement)(l.Button,{variant:"primary",onClick:()=>{const e=K.split("\n").map(e=>e.trim()).filter(Boolean),t=[];let a=null;if(e.forEach(e=>{if(e.toLowerCase().startsWith("q:"))return a={q:e.slice(2).trim(),a:""},void t.push(a);e.toLowerCase().startsWith("a:")?a&&(a.a=e.slice(2).trim()):a&&!a.a&&(a.a=e)}),!t.length)return;const n=[(0,c.createBlock)("core/heading",{level:2,content:"FAQ"})];t.forEach(e=>{n.push((0,c.createBlock)("core/heading",{level:3,content:e.q||"Question"})),n.push((0,c.createBlock)("core/paragraph",{content:e.a||""}))}),y(n)}},(0,g.__)("Insert FAQ","ai-gateway"))),fe("cta_builder")&&(0,t.createElement)(l.PanelBody,{title:(0,g.__)("CTA Builder","ai-gateway"),initialOpen:!1},(0,t.createElement)(l.TextControl,{label:(0,g.__)("Title","ai-gateway"),value:X,onChange:Y}),(0,t.createElement)(l.TextareaControl,{label:(0,g.__)("Body","ai-gateway"),value:Z,onChange:ee}),(0,t.createElement)(l.TextControl,{label:(0,g.__)("Button text","ai-gateway"),value:te,onChange:ae}),(0,t.createElement)(l.TextControl,{label:(0,g.__)("Button URL","ai-gateway"),value:ne,onChange:le}),(0,t.createElement)(l.Button,{variant:"primary",onClick:()=>{const e=[(0,c.createBlock)("core/group",{},[(0,c.createBlock)("core/heading",{level:2,content:X}),(0,c.createBlock)("core/paragraph",{content:Z}),h(te,ne)])];y(e)}},(0,g.__)("Insert CTA","ai-gateway"))),fe("quick_palette")&&(0,t.createElement)(l.PanelBody,{title:(0,g.__)("Quick Palette","ai-gateway"),initialOpen:!1},(0,t.createElement)(l.TextControl,{label:(0,g.__)("Text color (hex)","ai-gateway"),value:oe,onChange:re}),(0,t.createElement)(l.TextControl,{label:(0,g.__)("Background color (hex)","ai-gateway"),value:ce,onChange:ie}),(0,t.createElement)(l.ToggleControl,{label:(0,g.__)("Apply to all blocks","ai-gateway"),checked:se,onChange:ue}),(0,t.createElement)(l.Button,{variant:"primary",onClick:()=>{const e=se?F:ve?[ve]:[];e.length&&e.forEach(e=>{const t={...e.attributes},a={...t.style||{}};oe&&(a.color={...a.color||{},text:oe}),ce&&(a.color={...a.color||{},background:ce}),t.style=a,(0,r.dispatch)("core/block-editor").updateBlockAttributes(e.clientId,t)})}},(0,g.__)("Apply palette","ai-gateway"))),fe("media_insert")&&(0,t.createElement)(l.PanelBody,{title:(0,g.__)("Media Smart Insert","ai-gateway"),initialOpen:!1},(0,t.createElement)(u.MediaUploadCheck,null,(0,t.createElement)(u.MediaUpload,{onSelect:e=>{if(!e||!e.url)return;const t=(0,c.createBlock)("core/image",{id:e.id,url:e.url,alt:e.alt||""});y([t])},allowedTypes:["image"],render:({open:e})=>(0,t.createElement)(l.Button,{variant:"secondary",onClick:e},(0,g.__)("Select image","ai-gateway"))}))),fe("hero_section")&&(0,t.createElement)(l.PanelBody,{title:(0,g.__)("Hero Section","ai-gateway"),initialOpen:!1},(0,t.createElement)(l.TextControl,{label:(0,g.__)("Title","ai-gateway"),value:ge,onChange:pe}),(0,t.createElement)(l.TextareaControl,{label:(0,g.__)("Subtitle","ai-gateway"),value:de,onChange:me}),(0,t.createElement)(l.TextControl,{label:(0,g.__)("Button text","ai-gateway"),value:_e,onChange:ye}),(0,t.createElement)(l.TextControl,{label:(0,g.__)("Button URL","ai-gateway"),value:he,onChange:we}),(0,t.createElement)(u.MediaUploadCheck,null,(0,t.createElement)(u.MediaUpload,{onSelect:Be,allowedTypes:["image"],render:({open:e})=>(0,t.createElement)(l.Button,{variant:"secondary",onClick:e},ke?.url?(0,g.__)("Change image","ai-gateway"):(0,g.__)("Select image","ai-gateway"))})),(0,t.createElement)(l.Button,{variant:"primary",onClick:()=>{const e={url:ke?.url||void 0,dimRatio:30},t=[(0,c.createBlock)("core/heading",{level:1,content:ge}),(0,c.createBlock)("core/paragraph",{content:de}),h(_e,he)],a=(0,c.createBlock)("core/cover",e,t);y([a])}},(0,g.__)("Insert hero","ai-gateway"))))}})})();