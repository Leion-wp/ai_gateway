(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var i in a)e.o(a,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:a[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.blocks,i=window.wp.blockEditor,n=window.wp.apiFetch;var s=e.n(n);const o=window.wp.i18n,l=window.wp.element,c=window.AIGatewaySettings||{restUrl:"",nonce:"",agents:[]};function r(){const[e,a]=(0,l.useState)(c.agents||[]),[i,n]=(0,l.useState)(c.studioDefaultAgent||c.agents?.[0]?.id||0),[r,d]=(0,l.useState)(""),[m,u]=(0,l.useState)({}),[p,g]=(0,l.useState)([]),[y,w]=(0,l.useState)([]),[v,E]=(0,l.useState)(0),[_,h]=(0,l.useState)([]),[f,b]=(0,l.useState)(0),[N,k]=(0,l.useState)(!1),[S,C]=(0,l.useState)(""),[T,$]=(0,l.useState)(!1),[P,A]=(0,l.useState)("empty"),[O,j]=(0,l.useState)(null),[D,I]=(0,l.useState)(0),[x,U]=(0,l.useState)(""),[R,M]=(0,l.useState)(!1),[F,L]=(0,l.useState)(360),[W,G]=(0,l.useState)(!1),[B,q]=(0,l.useState)([]),[J,z]=(0,l.useState)(""),[X,H]=(0,l.useState)(""),[K,Q]=(0,l.useState)(null),[V,Y]=(0,l.useState)([]),[Z,ee]=(0,l.useState)(!1),[te,ae]=(0,l.useState)(!1),[ie,ne]=(0,l.useState)(!1),[se,oe]=(0,l.useState)(!1),[le,ce]=(0,l.useState)(""),[re,de]=(0,l.useState)("article"),[me,ue]=(0,l.useState)(""),[pe,ge]=(0,l.useState)(""),[ye,we]=(0,l.useState)(""),[ve,Ee]=(0,l.useState)([]),[_e,he]=(0,l.useState)(0),[fe,be]=(0,l.useState)(""),[Ne,ke]=(0,l.useState)([]),[Se,Ce]=(0,l.useState)(""),Te=async(e,t,a)=>{if(e)try{await s()({path:`/ai/v1/conversations/${e}/messages`,method:"POST",data:{role:t,content:a}})}catch(e){$e(e.message||"Failed to save message.")}},$e=e=>{C(e),Ee(t=>[{message:e,time:(new Date).toISOString()},...t.slice(0,9)])},Pe=(0,l.useMemo)(()=>e.find(e=>e.id===i),[e,i]),Ae=(e=>(e||[]).map(e=>"string"==typeof e?{key:e,label:e,type:"text"}:e&&e.key?{key:e.key,label:e.label||e.key,type:e.type||"text",options:e.options||[],placeholder:e.placeholder||"",required:Boolean(e.required),env:e.env||""}:null).filter(Boolean))(Pe?.input_schema||[]).filter(e=>!e.env),Oe=c.adminUrl||"/wp-admin/",je=Pe?.tools||[],De=(0,l.useMemo)(()=>{const t={};return e.forEach(e=>{t[e.id]=e}),t},[e]),Ie=()=>{const e={};Ae.forEach(t=>{e[t.key]=""}),u(e)};(0,l.useEffect)(()=>{if(e.length)return;let t=!0;return(async()=>{try{const e=await s()({path:"/ai/v1/agents?enabled=1",method:"GET"});if(!t)return;const i=Array.isArray(e)?e:[];a(i);const o=c.studioDefaultAgent||0,l=i.find(e=>e.id===o);n(l?.id||i[0]?.id||0)}catch(e){t&&$e(e.message||"Failed to load agents.")}})(),()=>{t=!1}},[e.length]),(0,l.useEffect)(()=>{Ie(),q(Pe?.tools||[])},[i]),(0,l.useEffect)(()=>{if(!W)return;const e=e=>{const t=Math.min(640,Math.max(260,window.innerWidth-e.clientX-24));L(t)},t=()=>{G(!1)};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[W]),(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{const t=await s()({path:"/ai/v1/projects",method:"GET"}),a=Array.isArray(t)?t:[];if(!e)return;if(!a.length){const e=await s()({path:"/ai/v1/projects",method:"POST",data:{name:"General"}});return w([e]),void E(e.id)}w(a),E(a[0]?.id||0)}catch(t){e&&$e(t.message||"Failed to load projects.")}})(),()=>{e=!1}},[]),(0,l.useEffect)(()=>{if(!v)return;let e=!0;return(async()=>{try{const t=await s()({path:`/ai/v1/conversations?project_id=${v}&include_archived=${te?"1":"0"}`,method:"GET"});if(!e)return;const a=Array.isArray(t)?t:[];h(a),b(a[0]?.id||0)}catch(t){e&&$e(t.message||"Failed to load conversations.")}})(),()=>{e=!1}},[v,te]),(0,l.useEffect)(()=>{if(!f)return void g([]);let e=!0;return(async()=>{try{const t=await s()({path:`/ai/v1/conversations/${f}`,method:"GET"});e&&t?.messages&&g(t.messages)}catch(t){e&&$e(t.message||"Failed to load conversation.")}})(),()=>{e=!1}},[f]),(0,l.useEffect)(()=>{if(!f)return void ke([]);let e=!0;return(async()=>{try{const t=await s()({path:`/ai/v1/conversations/${f}/workflow`,method:"GET"});e&&ke(Array.isArray(t?.workflow)?t.workflow:[])}catch(e){$e(e.message||"Failed to load workflow.")}})(),()=>{e=!1}},[f]);const xe=(e,t)=>{g(a=>{if(!a.length)return a;const i=[...a],n=i[i.length-1];return"assistant"!==n.role?a:(i[i.length-1]={...n,content:t?e:n.content+e},i)})},Ue=async()=>{k(!0),ne(!0),C("");const e=B.length?`${r}\n\nTools: ${B.join(", ")}`:r;let t=f;if(!t){const e=await s()({path:"/ai/v1/conversations",method:"POST",data:{name:"Conversation",project_id:v}});t=e.id,h(t=>[e,...t]),b(e.id)}g(e=>[...e,{role:"user",content:r}]),Te(t,"user",e);try{for(const a of V){const i=await s()({path:"/ai/v1/run",method:"POST",data:{agent_id:a,instruction:e,inputs:m}}),n=i?.mcp_response||i?.ollama_response||i?.error||"",o=`${De[a]?.name||"Agent"}: ${n}`;g(e=>[...e,{role:"assistant",content:o}]),Te(t,"assistant",o)}}catch(e){$e(e.message||"Chain failed.")}finally{k(!1),ne(!1),d("")}},Re=async e=>{f&&await s()({path:`/ai/v1/conversations/${f}/workflow`,method:"POST",data:{workflow:e}})};return(0,l.useEffect)(()=>{if(!f||0===p.length)return;const e=setTimeout(async()=>{try{await s()({path:`/ai/v1/conversations/${f}/draft`,method:"POST",data:{messages:p}})}catch(e){$e(e.message||"Failed to save draft.")}},1200);return()=>clearTimeout(e)},[f,p]),(0,t.createElement)("div",{className:"ai-studio-app",style:{gridTemplateColumns:`280px 1fr ${F}px`}},(0,t.createElement)("aside",{className:"ai-studio-sidebar"},(0,t.createElement)("div",{className:"ai-studio-sidebar-section"},(0,t.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Projects","ai-gateway")),(0,t.createElement)("div",{className:"ai-studio-project-row"},(0,t.createElement)("select",{className:"ai-studio-select",value:v,onChange:e=>E(Number(e.target.value))},y.map(e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.name))),(0,t.createElement)("button",{type:"button",className:"ai-studio-icon-button",onClick:()=>{oe(!0);const e=y.find(e=>e.id===v);ce(e?.name||"")}},"⋯"))),(0,t.createElement)("div",{className:"ai-studio-sidebar-section"},(0,t.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Conversations","ai-gateway")),(0,t.createElement)("label",{className:"ai-studio-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:te,onChange:e=>ae(e.target.checked)}),(0,o.__)("Show archived","ai-gateway")),(0,t.createElement)("div",{className:"ai-studio-conversation-list"},_.map(e=>(0,t.createElement)("div",{key:e.id,className:"ai-studio-conversation-row"},(0,t.createElement)("button",{type:"button",className:"ai-studio-conversation "+(e.id===f?"active":""),onClick:()=>b(e.id)},(0,t.createElement)("div",{className:"ai-studio-conversation-title"},e.name),e.archived&&(0,t.createElement)("div",{className:"ai-studio-conversation-last"},(0,o.__)("Archived","ai-gateway")),e.last&&(0,t.createElement)("div",{className:"ai-studio-conversation-last"},e.last)),(0,t.createElement)("button",{type:"button",className:"ai-studio-icon-button",onClick:()=>{j(e.id),I(0),U("")}},"⋯")))),(0,t.createElement)("button",{type:"button",className:"ai-studio-button secondary",onClick:async()=>{const e=await s()({path:"/ai/v1/conversations",method:"POST",data:{name:"Conversation",project_id:v}});h(t=>[e,...t]),b(e.id)}},(0,o.__)("New chat","ai-gateway"))),(0,t.createElement)("div",{className:"ai-studio-sidebar-section"},(0,t.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Agents","ai-gateway")),(0,t.createElement)("select",{className:"ai-studio-select",value:i,onChange:e=>n(Number(e.target.value))},e.map(e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.name)))),(0,t.createElement)("div",{className:"ai-studio-sidebar-section"},(0,t.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Tools","ai-gateway")),0===je.length&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},(0,o.__)("Assigned via agent.","ai-gateway")),je.map(e=>(0,t.createElement)("label",{key:e,className:"ai-studio-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:B.includes(e),onChange:t=>{const a=t.target.checked;q(t=>a?[...t,e]:t.filter(t=>t!==e))}}),e))),(0,t.createElement)("div",{className:"ai-studio-sidebar-section"},(0,t.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Settings","ai-gateway")),(0,t.createElement)("button",{type:"button",className:"ai-studio-button secondary",onClick:()=>$(!0)},(0,o.__)("Open settings","ai-gateway")),(0,t.createElement)("button",{type:"button",className:"ai-studio-button secondary",onClick:()=>A("agents")},(0,o.__)("Agents editor","ai-gateway")))),(0,t.createElement)("main",{className:"ai-studio-main"},(0,t.createElement)("div",{className:"ai-studio-topbar"},(0,t.createElement)("div",{className:"ai-studio-topbar-left"},(0,t.createElement)("span",{className:"ai-studio-topbar-label"},(0,o.__)("Active agent","ai-gateway")),(0,t.createElement)("span",{className:"ai-studio-topbar-value"},Pe?.name||(0,o.__)("None","ai-gateway"))),(0,t.createElement)("div",{className:"ai-studio-topbar-right"},(0,t.createElement)("span",{className:"ai-studio-status-dot"}),(0,t.createElement)("span",null,(0,o.__)("Ollama: online","ai-gateway")),(0,t.createElement)("select",{className:"ai-studio-select",value:P,onChange:e=>A(e.target.value)},(0,t.createElement)("option",{value:"empty"},(0,o.__)("Chat","ai-gateway")),(0,t.createElement)("option",{value:"editor"},(0,o.__)("Editor","ai-gateway")),(0,t.createElement)("option",{value:"workflow"},(0,o.__)("Workflow","ai-gateway")),(0,t.createElement)("option",{value:"preview"},(0,o.__)("Preview","ai-gateway")),(0,t.createElement)("option",{value:"agents"},(0,o.__)("Agents","ai-gateway"))))),(0,t.createElement)("div",{className:"ai-studio-chat"},p.map((e,a)=>(0,t.createElement)("div",{key:a,className:`ai-studio-message ai-studio-${e.role}`},(0,t.createElement)("div",{className:"ai-studio-message-role"},e.role),(0,t.createElement)("div",{className:"ai-studio-message-content"},e.content))),ie&&(0,t.createElement)("div",{className:"ai-studio-typing"},Pe?.name||(0,o.__)("Agent","ai-gateway")," ",(0,o.__)("is typing...","ai-gateway"))),ve.length>0&&(0,t.createElement)("div",{className:"ai-studio-error-log"},(0,t.createElement)("strong",null,(0,o.__)("Errors","ai-gateway")),ve.map((e,a)=>(0,t.createElement)("div",{key:a,className:"ai-studio-error-item"},e.message))),Ae.length>0&&(0,t.createElement)("div",{className:"ai-studio-inputs"},Ae.map(e=>(0,t.createElement)("label",{key:e.key,className:"ai-studio-field"},(0,t.createElement)("span",null,e.label),(0,t.createElement)("input",{type:"number"===e.type?"number":"url"===e.type?"url":"text",value:m[e.key]||"",placeholder:e.placeholder,onChange:t=>u(a=>({...a,[e.key]:t.target.value}))})))),(0,t.createElement)("div",{className:"ai-studio-composer"},S&&(0,t.createElement)("div",{className:"ai-studio-error"},S),(0,t.createElement)("div",{className:"ai-studio-composer-row"},(0,t.createElement)("button",{className:"ai-studio-button icon",type:"button",title:(0,o.__)("Add","ai-gateway"),onClick:()=>M(e=>!e)},"+"),R&&(0,t.createElement)("div",{className:"ai-studio-plus-menu"},(0,t.createElement)("button",{type:"button",onClick:()=>{M(!1),A("tools")}},(0,o.__)("Tools","ai-gateway")),(0,t.createElement)("button",{type:"button",onClick:()=>{M(!1),A("upload")}},(0,o.__)("Upload image","ai-gateway")),(0,t.createElement)("button",{type:"button",onClick:()=>{M(!1),A("chain")}},(0,o.__)("Chain agents","ai-gateway"))),(0,t.createElement)("textarea",{className:"ai-studio-textarea",rows:"3",placeholder:(0,o.__)("Ask something...","ai-gateway"),value:r,onChange:e=>d(e.target.value)}),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{if(!i)return void $e("No agent selected.");if(Z&&V.length>0)return void await Ue();k(!0),ne(!0),C("");const e=B.length?`${r}\n\nTools: ${B.join(", ")}`:r;let t=f;if(!t){const e=await s()({path:"/ai/v1/conversations",method:"POST",data:{name:"Conversation",project_id:v}});t=e.id,h(t=>[e,...t]),b(e.id)}const a={role:"user",content:r};g(e=>[...e,a,{role:"assistant",content:""}]),Te(t,"user",e);try{const a=`${c.restUrl?c.restUrl.replace(/\/$/,""):"/wp-json/ai/v1"}/run/stream`,n=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":c.nonce||""},body:JSON.stringify({agent_id:i,instruction:e,inputs:m})}),s=n.headers.get("content-type")||"";if(!n.ok||!n.body||!s.includes("text/event-stream"))throw new Error("Stream unavailable");const o=n.body.getReader(),l=new TextDecoder("utf-8");let r="";for(;;){const{value:e,done:a}=await o.read();if(a)break;r+=l.decode(e,{stream:!0});const i=r.split("\n\n");r=i.pop()||"",i.forEach(e=>{e.split("\n").forEach(e=>{if(!e.startsWith("data: "))return;const a=e.slice(6).trim();if(a)try{const e=JSON.parse(a);if(e.error)return void $e(e.error);e.delta&&xe(e.delta,!1),e.done&&e.full&&(xe(e.full,!0),Te(t,"assistant",e.full),ne(!1))}catch(e){$e(e.message||"Stream parse error.")}})})}}catch(a){try{const a=await s()({path:"/ai/v1/run",method:"POST",data:{agent_id:i,instruction:e,inputs:m}});if(a?.error)$e(a.error);else{const e=a?.mcp_response||a?.ollama_response||"";xe(e,!0),Te(t,"assistant",e)}}catch(e){$e(e.message||a.message||"Stream failed.")}}finally{k(!1),d(""),ne(!1)}},disabled:N},N?(0,o.__)("Running...","ai-gateway"):(0,o.__)("Send","ai-gateway"))),(0,t.createElement)("div",{className:"ai-studio-actions"},(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:Ie},(0,o.__)("Reset","ai-gateway")),(0,t.createElement)("label",{className:"ai-studio-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:Z,onChange:e=>ee(e.target.checked)}),(0,o.__)("Use chain","ai-gateway"))))),(0,t.createElement)("aside",{className:"ai-studio-workspace"},(0,t.createElement)("div",{className:"ai-studio-resizer",onMouseDown:()=>G(!0),title:(0,o.__)("Resize","ai-gateway")}),"agents"===P?(0,t.createElement)("iframe",{title:"Agents",className:"ai-studio-iframe",src:`${Oe}admin.php?page=ai-gateway-agents&action=edit&agent_id=${i}&studio=1`}):"tools"===P?(0,t.createElement)("div",{className:"ai-studio-workspace-empty"},(0,o.__)("Tools panel (coming soon)","ai-gateway")):"upload"===P?(0,t.createElement)("div",{className:"ai-studio-workspace-panel"},(0,t.createElement)("h3",null,(0,o.__)("Upload image","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>{if(!window.wp||!window.wp.media)return void $e("Media library not available.");const e=window.wp.media({title:"Select image",multiple:!1,library:{type:"image"}});e.on("select",()=>{const t=e.state().get("selection").first();if(!t)return;const a=t.toJSON();Q({id:a.id,url:a.url})}),e.open()}},(0,o.__)("Open Media Library","ai-gateway")),(0,t.createElement)("input",{className:"ai-studio-input",value:J,onChange:e=>z(e.target.value),placeholder:(0,o.__)("Image URL","ai-gateway")}),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{H("");try{const e=await s()({path:"/ai/v1/media/import",method:"POST",data:{url:J}});H(e?.url?`Imported: ${e.url}`:"Imported"),e?.url&&Q({id:e.attachment_id,url:e.url})}catch(e){H(e.message||"Upload failed.")}}},(0,o.__)("Import","ai-gateway")),K?.url&&(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{let e=f;if(!e){const t=await s()({path:"/ai/v1/conversations",method:"POST",data:{name:"Conversation",project_id:v}});e=t.id,h(e=>[t,...e]),b(t.id)}const t=`![image](${K.url})`;g(e=>[...e,{role:"user",content:t}]),Te(e,"user",t)}},(0,o.__)("Insert into chat","ai-gateway")),X&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},X)):"chain"===P?(0,t.createElement)("div",{className:"ai-studio-workspace-panel"},(0,t.createElement)("h3",null,(0,o.__)("Agent chain","ai-gateway")),e.map(e=>(0,t.createElement)("label",{key:e.id,className:"ai-studio-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:V.includes(e.id),onChange:t=>{const a=t.target.checked;Y(t=>a?[...t,e.id]:t.filter(t=>t!==e.id))}}),e.name)),(0,t.createElement)("button",{className:"ai-studio-button",onClick:Ue,disabled:N},(0,o.__)("Run chain","ai-gateway"))):"editor"===P?(0,t.createElement)("div",{className:"ai-studio-workspace-panel"},(0,t.createElement)("h3",null,(0,o.__)("Content editor","ai-gateway")),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Type","ai-gateway")),(0,t.createElement)("select",{className:"ai-studio-select",value:re,onChange:e=>de(e.target.value)},(0,t.createElement)("option",{value:"article"},(0,o.__)("Article","ai-gateway")),(0,t.createElement)("option",{value:"page"},(0,o.__)("Page","ai-gateway")),(0,t.createElement)("option",{value:"workflow"},(0,o.__)("Workflow","ai-gateway")))),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Title","ai-gateway")),(0,t.createElement)("input",{className:"ai-studio-input",value:me,onChange:e=>ue(e.target.value)})),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Content","ai-gateway")),(0,t.createElement)("textarea",{className:"ai-studio-textarea editor",rows:"8",value:pe,onChange:e=>ge(e.target.value)})),ye&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},ye),_e>0&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},`Draft ID: ${_e}`),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{we("");try{const e="page"===re?"/wp/v2/pages":"/wp/v2/posts",t=await s()({path:e,method:"POST",data:{title:me||"Draft",content:pe,status:"draft"}});we(`Draft created: #${t.id}`),he(t.id||0),t?.id&&be("page"===re?`${window.location.origin}/?page_id=${t.id}&preview=true`:`${window.location.origin}/?p=${t.id}&preview=true`)}catch(e){we(e.message||"Failed to create draft.")}}},(0,o.__)("Create draft","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>{const e=[...p].reverse().find(e=>"assistant"===e.role);e&&ge(e.content)}},(0,o.__)("Use last assistant","ai-gateway")),_e>0&&(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{we("");try{const e="page"===re?`/wp/v2/pages/${_e}`:`/wp/v2/posts/${_e}`;await s()({path:e,method:"POST",data:{title:me||"Draft",content:pe}}),we("Draft updated.")}catch(e){we(e.message||"Failed to update draft.")}}},(0,o.__)("Update draft","ai-gateway"))):"workflow"===P?(0,t.createElement)("div",{className:"ai-studio-workspace-panel"},(0,t.createElement)("h3",null,(0,o.__)("Workflow builder","ai-gateway")),Ne.map((a,i)=>(0,t.createElement)("div",{key:`${a.type}-${i}`,className:"ai-studio-workflow-node"},(0,t.createElement)("strong",null,a.type),"run_agent"===a.type&&(0,t.createElement)("select",{className:"ai-studio-select",value:a.agentId||"",onChange:e=>{const t=[...Ne];t[i]={...a,agentId:Number(e.target.value)},ke(t),Re(t)}},(0,t.createElement)("option",{value:""},(0,o.__)("Select agent","ai-gateway")),e.map(e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.name))),("create_draft"===a.type||"update_draft"===a.type)&&(0,t.createElement)("select",{className:"ai-studio-select",value:a.postType||"article",onChange:e=>{const t=[...Ne];t[i]={...a,postType:e.target.value},ke(t),Re(t)}},(0,t.createElement)("option",{value:"article"},(0,o.__)("Article","ai-gateway")),(0,t.createElement)("option",{value:"page"},(0,o.__)("Page","ai-gateway"))),"create_draft"===a.type&&(0,t.createElement)("input",{className:"ai-studio-input",value:a.title||"",placeholder:(0,o.__)("Draft title","ai-gateway"),onChange:e=>{const t=[...Ne];t[i]={...a,title:e.target.value},ke(t),Re(t)}}),"update_draft"===a.type&&(0,t.createElement)("input",{className:"ai-studio-input",value:a.postId||"",placeholder:(0,o.__)("Draft ID","ai-gateway"),onChange:e=>{const t=[...Ne];t[i]={...a,postId:Number(e.target.value)},ke(t),Re(t)}}),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>{const e=Ne.filter((e,t)=>t!==i);ke(e),Re(e)}},(0,o.__)("Remove","ai-gateway")))),(0,t.createElement)("div",{className:"ai-studio-workflow-actions"},(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>{const e=[...Ne,{type:"run_agent",agentId:i||0}];ke(e),Re(e)}},(0,o.__)("Add Agent","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>{const e=[...Ne,{type:"create_draft",postType:"article",title:""}];ke(e),Re(e)}},(0,o.__)("Add Draft","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>{const e=[...Ne,{type:"update_draft",postType:"article",postId:0}];ke(e),Re(e)}},(0,o.__)("Update Draft","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>{const e=[...Ne,{type:"insert_image"}];ke(e),Re(e)}},(0,o.__)("Insert Image","ai-gateway"))),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{if(Ne.length){Ce("Running...");try{let e="";for(const t of Ne){if("run_agent"===t.type){const a=await s()({path:"/ai/v1/run",method:"POST",data:{agent_id:t.agentId,instruction:r,inputs:m}});e=a?.mcp_response||a?.ollama_response||""}if("create_draft"===t.type){const a="page"===t.postType?"/wp/v2/pages":"/wp/v2/posts",i=await s()({path:a,method:"POST",data:{title:t.title||"Draft",content:e,status:"draft"}});he(i?.id||0),i?.id&&be("page"===t.postType?`${window.location.origin}/?page_id=${i.id}&preview=true`:`${window.location.origin}/?p=${i.id}&preview=true`)}if("update_draft"===t.type&&t.postId){const a="page"===t.postType?`/wp/v2/pages/${t.postId}`:`/wp/v2/posts/${t.postId}`;await s()({path:a,method:"POST",data:{content:e}})}"insert_image"===t.type&&K?.url&&(e+=`\n\n![image](${K.url})`)}Ce("Done")}catch(e){$e(e.message||"Workflow failed."),Ce("Failed")}}else $e("No workflow nodes.")},disabled:N},(0,o.__)("Run workflow","ai-gateway")),Se&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},Se)):"preview"===P?(0,t.createElement)("div",{className:"ai-studio-workspace-panel"},(0,t.createElement)("h3",null,(0,o.__)("Preview","ai-gateway")),fe?(0,t.createElement)("iframe",{title:"Preview",className:"ai-studio-iframe",src:fe}):(0,t.createElement)("div",{className:"ai-studio-workspace-empty"},(0,o.__)("No preview yet.","ai-gateway"))):(0,t.createElement)("div",{className:"ai-studio-workspace-empty"},(0,o.__)("Workspace","ai-gateway"))),O&&(0,t.createElement)("div",{className:"ai-studio-modal"},(0,t.createElement)("div",{className:"ai-studio-modal-card"},(0,t.createElement)("h3",null,(0,o.__)("Conversation actions","ai-gateway")),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Rename","ai-gateway")),(0,t.createElement)("input",{value:_.find(e=>e.id===O)?.name||"",onChange:e=>{const t=e.target.value;h(e=>e.map(e=>e.id===O?{...e,name:t}:e))}})),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Move to project","ai-gateway")),(0,t.createElement)("select",{className:"ai-studio-select",value:D,onChange:e=>I(Number(e.target.value))},(0,t.createElement)("option",{value:"0"},(0,o.__)("Select project","ai-gateway")),y.map(e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.name)))),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Or create project","ai-gateway")),(0,t.createElement)("input",{value:x,onChange:e=>U(e.target.value),placeholder:(0,o.__)("New project name","ai-gateway")})),(0,t.createElement)("div",{className:"ai-studio-modal-actions"},(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{const e=_.find(e=>e.id===O)?.name||"";await s()({path:`/ai/v1/conversations/${O}`,method:"PUT",data:{name:e}}),j(null)}},(0,o.__)("Rename","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{await(async e=>{let t=D;if(!t&&""!==x.trim()){const e=await s()({path:"/ai/v1/projects",method:"POST",data:{name:x.trim()}});w(t=>[e,...t]),t=e.id}t&&(await s()({path:`/ai/v1/conversations/${e}`,method:"PUT",data:{project_id:t}}),h(t=>t.filter(t=>t.id!==e)),f===e&&b(0))})(O),j(null)}},(0,o.__)("Move","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{await(async e=>{await s()({path:`/ai/v1/conversations/${e}/archive`,method:"POST"}),h(t=>t.filter(t=>t.id!==e)),f===e&&b(0)})(O),j(null)}},(0,o.__)("Archive","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{await(async e=>{await s()({path:`/ai/v1/conversations/${e}`,method:"DELETE"}),h(t=>t.filter(t=>t.id!==e)),f===e&&b(0)})(O),j(null)}},(0,o.__)("Delete","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>j(null)},(0,o.__)("Cancel","ai-gateway"))))),se&&(0,t.createElement)("div",{className:"ai-studio-modal"},(0,t.createElement)("div",{className:"ai-studio-modal-card"},(0,t.createElement)("h3",null,(0,o.__)("Project actions","ai-gateway")),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Rename","ai-gateway")),(0,t.createElement)("input",{value:le,onChange:e=>ce(e.target.value)})),(0,t.createElement)("div",{className:"ai-studio-modal-actions"},(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{await s()({path:`/ai/v1/projects/${v}`,method:"PUT",data:{name:le}}),w(e=>e.map(e=>e.id===v?{...e,name:le}:e)),oe(!1)}},(0,o.__)("Rename","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{await s()({path:`/ai/v1/projects/${v}`,method:"DELETE"}),w(e=>e.filter(e=>e.id!==v)),E(0),oe(!1)}},(0,o.__)("Delete","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>oe(!1)},(0,o.__)("Cancel","ai-gateway"))))),T&&(0,t.createElement)("div",{className:"ai-studio-modal"},(0,t.createElement)("div",{className:"ai-studio-modal-card large"},(0,t.createElement)("div",{className:"ai-studio-modal-header"},(0,t.createElement)("h3",null,(0,o.__)("Settings","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-icon-button",onClick:()=>$(!1)},"✕")),(0,t.createElement)("iframe",{title:"Settings",className:"ai-studio-iframe",src:`${Oe}admin.php?page=ai-gateway-settings&studio=1`}))))}c.nonce&&s().use(s().createNonceMiddleware(c.nonce)),(0,a.registerBlockType)("ai-gateway/studio",{title:(0,o.__)("AI Studio","ai-gateway"),icon:"format-chat",category:"widgets",edit(){const e=(0,i.useBlockProps)({className:"ai-studio-block-placeholder"});return(0,t.createElement)("div",{...e},(0,o.__)("AI Studio App","ai-gateway"))},save(){const e=i.useBlockProps.save({className:"ai-studio-app"});return(0,t.createElement)("div",{...e})}});const d=()=>{const e=document.querySelectorAll(".ai-studio-app");e.length&&e.forEach(e=>{window.wp.element.render((0,t.createElement)(r,null),e)})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d()})();