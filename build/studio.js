(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var i in t)e.o(t,i)&&!e.o(a,i)&&Object.defineProperty(a,i,{enumerable:!0,get:t[i]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.React,t=window.wp.blocks,i=window.wp.blockEditor,n=window.wp.apiFetch;var s=e.n(n);const o=window.wp.i18n,l=window.wp.element,c=window.AIGatewaySettings||{restUrl:"",nonce:"",agents:[]};function r(){const[e,t]=(0,l.useState)(c.agents||[]),[i,n]=(0,l.useState)(c.studioDefaultAgent||c.agents?.[0]?.id||0),[r,d]=(0,l.useState)(""),[m,u]=(0,l.useState)({}),[p,g]=(0,l.useState)([]),[y,v]=(0,l.useState)([]),[w,E]=(0,l.useState)(0),[h,_]=(0,l.useState)([]),[b,N]=(0,l.useState)(0),[f,k]=(0,l.useState)(!1),[S,C]=(0,l.useState)(""),[T,A]=(0,l.useState)(!1),[P,$]=(0,l.useState)("empty"),[O,j]=(0,l.useState)(null),[x,D]=(0,l.useState)(0),[M,U]=(0,l.useState)(""),[R,L]=(0,l.useState)(!1),[I,F]=(0,l.useState)(360),[W,G]=(0,l.useState)(!1),[B,q]=(0,l.useState)([]),[J,z]=(0,l.useState)(""),[X,H]=(0,l.useState)(""),[K,Q]=(0,l.useState)(null),[V,Y]=(0,l.useState)([]),[Z,ee]=(0,l.useState)(!1),[ae,te]=(0,l.useState)(!1),[ie,ne]=(0,l.useState)(!1),[se,oe]=(0,l.useState)(!1),[le,ce]=(0,l.useState)(""),[re,de]=(0,l.useState)("article"),[me,ue]=(0,l.useState)(""),[pe,ge]=(0,l.useState)(""),[ye,ve]=(0,l.useState)(""),[we,Ee]=(0,l.useState)([]),he=async(e,a,t)=>{if(e)try{await s()({path:`/ai/v1/conversations/${e}/messages`,method:"POST",data:{role:a,content:t}})}catch(e){_e(e.message||"Failed to save message.")}},_e=e=>{C(e),Ee(a=>[{message:e,time:(new Date).toISOString()},...a.slice(0,9)])},be=(0,l.useMemo)(()=>e.find(e=>e.id===i),[e,i]),Ne=(e=>(e||[]).map(e=>"string"==typeof e?{key:e,label:e,type:"text"}:e&&e.key?{key:e.key,label:e.label||e.key,type:e.type||"text",options:e.options||[],placeholder:e.placeholder||"",required:Boolean(e.required),env:e.env||""}:null).filter(Boolean))(be?.input_schema||[]).filter(e=>!e.env),fe=c.adminUrl||"/wp-admin/",ke=be?.tools||[],Se=(0,l.useMemo)(()=>{const a={};return e.forEach(e=>{a[e.id]=e}),a},[e]),Ce=()=>{const e={};Ne.forEach(a=>{e[a.key]=""}),u(e)};(0,l.useEffect)(()=>{if(e.length)return;let a=!0;return(async()=>{try{const e=await s()({path:"/ai/v1/agents?enabled=1",method:"GET"});if(!a)return;const i=Array.isArray(e)?e:[];t(i);const o=c.studioDefaultAgent||0,l=i.find(e=>e.id===o);n(l?.id||i[0]?.id||0)}catch(e){a&&_e(e.message||"Failed to load agents.")}})(),()=>{a=!1}},[e.length]),(0,l.useEffect)(()=>{Ce(),q(be?.tools||[])},[i]),(0,l.useEffect)(()=>{if(!W)return;const e=e=>{const a=Math.min(640,Math.max(260,window.innerWidth-e.clientX-24));F(a)},a=()=>{G(!1)};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",a),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",a)}},[W]),(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{const a=await s()({path:"/ai/v1/projects",method:"GET"}),t=Array.isArray(a)?a:[];if(!e)return;if(!t.length){const e=await s()({path:"/ai/v1/projects",method:"POST",data:{name:"General"}});return v([e]),void E(e.id)}v(t),E(t[0]?.id||0)}catch(a){e&&_e(a.message||"Failed to load projects.")}})(),()=>{e=!1}},[]),(0,l.useEffect)(()=>{if(!w)return;let e=!0;return(async()=>{try{const a=await s()({path:`/ai/v1/conversations?project_id=${w}&include_archived=${ae?"1":"0"}`,method:"GET"});if(!e)return;const t=Array.isArray(a)?a:[];_(t),N(t[0]?.id||0)}catch(a){e&&_e(a.message||"Failed to load conversations.")}})(),()=>{e=!1}},[w,ae]),(0,l.useEffect)(()=>{if(!b)return void g([]);let e=!0;return(async()=>{try{const a=await s()({path:`/ai/v1/conversations/${b}`,method:"GET"});e&&a?.messages&&g(a.messages)}catch(a){e&&_e(a.message||"Failed to load conversation.")}})(),()=>{e=!1}},[b]);const Te=(e,a)=>{g(t=>{if(!t.length)return t;const i=[...t],n=i[i.length-1];return"assistant"!==n.role?t:(i[i.length-1]={...n,content:a?e:n.content+e},i)})},Ae=async()=>{k(!0),ne(!0),C("");const e=B.length?`${r}\n\nTools: ${B.join(", ")}`:r;let a=b;if(!a){const e=await s()({path:"/ai/v1/conversations",method:"POST",data:{name:"Conversation",project_id:w}});a=e.id,_(a=>[e,...a]),N(e.id)}g(e=>[...e,{role:"user",content:r}]),he(a,"user",e);try{for(const t of V){const i=await s()({path:"/ai/v1/run",method:"POST",data:{agent_id:t,instruction:e,inputs:m}}),n=i?.mcp_response||i?.ollama_response||i?.error||"",o=`${Se[t]?.name||"Agent"}: ${n}`;g(e=>[...e,{role:"assistant",content:o}]),he(a,"assistant",o)}}catch(e){_e(e.message||"Chain failed.")}finally{k(!1),ne(!1),d("")}};return(0,l.useEffect)(()=>{if(!b||0===p.length)return;const e=setTimeout(async()=>{try{await s()({path:`/ai/v1/conversations/${b}/draft`,method:"POST",data:{messages:p}})}catch(e){_e(e.message||"Failed to save draft.")}},1200);return()=>clearTimeout(e)},[b,p]),(0,a.createElement)("div",{className:"ai-studio-app",style:{gridTemplateColumns:`280px 1fr ${I}px`}},(0,a.createElement)("aside",{className:"ai-studio-sidebar"},(0,a.createElement)("div",{className:"ai-studio-sidebar-section"},(0,a.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Projects","ai-gateway")),(0,a.createElement)("div",{className:"ai-studio-project-row"},(0,a.createElement)("select",{className:"ai-studio-select",value:w,onChange:e=>E(Number(e.target.value))},y.map(e=>(0,a.createElement)("option",{key:e.id,value:e.id},e.name))),(0,a.createElement)("button",{type:"button",className:"ai-studio-icon-button",onClick:()=>{oe(!0);const e=y.find(e=>e.id===w);ce(e?.name||"")}},"⋯"))),(0,a.createElement)("div",{className:"ai-studio-sidebar-section"},(0,a.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Conversations","ai-gateway")),(0,a.createElement)("label",{className:"ai-studio-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:ae,onChange:e=>te(e.target.checked)}),(0,o.__)("Show archived","ai-gateway")),(0,a.createElement)("div",{className:"ai-studio-conversation-list"},h.map(e=>(0,a.createElement)("div",{key:e.id,className:"ai-studio-conversation-row"},(0,a.createElement)("button",{type:"button",className:"ai-studio-conversation "+(e.id===b?"active":""),onClick:()=>N(e.id)},(0,a.createElement)("div",{className:"ai-studio-conversation-title"},e.name),e.archived&&(0,a.createElement)("div",{className:"ai-studio-conversation-last"},(0,o.__)("Archived","ai-gateway")),e.last&&(0,a.createElement)("div",{className:"ai-studio-conversation-last"},e.last)),(0,a.createElement)("button",{type:"button",className:"ai-studio-icon-button",onClick:()=>{j(e.id),D(0),U("")}},"⋯")))),(0,a.createElement)("button",{type:"button",className:"ai-studio-button secondary",onClick:async()=>{const e=await s()({path:"/ai/v1/conversations",method:"POST",data:{name:"Conversation",project_id:w}});_(a=>[e,...a]),N(e.id)}},(0,o.__)("New chat","ai-gateway"))),(0,a.createElement)("div",{className:"ai-studio-sidebar-section"},(0,a.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Agents","ai-gateway")),(0,a.createElement)("select",{className:"ai-studio-select",value:i,onChange:e=>n(Number(e.target.value))},e.map(e=>(0,a.createElement)("option",{key:e.id,value:e.id},e.name)))),(0,a.createElement)("div",{className:"ai-studio-sidebar-section"},(0,a.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Tools","ai-gateway")),0===ke.length&&(0,a.createElement)("div",{className:"ai-studio-sidebar-empty"},(0,o.__)("Assigned via agent.","ai-gateway")),ke.map(e=>(0,a.createElement)("label",{key:e,className:"ai-studio-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:B.includes(e),onChange:a=>{const t=a.target.checked;q(a=>t?[...a,e]:a.filter(a=>a!==e))}}),e))),(0,a.createElement)("div",{className:"ai-studio-sidebar-section"},(0,a.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Settings","ai-gateway")),(0,a.createElement)("button",{type:"button",className:"ai-studio-button secondary",onClick:()=>A(!0)},(0,o.__)("Open settings","ai-gateway")),(0,a.createElement)("button",{type:"button",className:"ai-studio-button secondary",onClick:()=>$("agents")},(0,o.__)("Agents editor","ai-gateway")))),(0,a.createElement)("main",{className:"ai-studio-main"},(0,a.createElement)("div",{className:"ai-studio-topbar"},(0,a.createElement)("div",{className:"ai-studio-topbar-left"},(0,a.createElement)("span",{className:"ai-studio-topbar-label"},(0,o.__)("Active agent","ai-gateway")),(0,a.createElement)("span",{className:"ai-studio-topbar-value"},be?.name||(0,o.__)("None","ai-gateway"))),(0,a.createElement)("div",{className:"ai-studio-topbar-right"},(0,a.createElement)("span",{className:"ai-studio-status-dot"}),(0,a.createElement)("span",null,(0,o.__)("Ollama: online","ai-gateway")),(0,a.createElement)("select",{className:"ai-studio-select",value:P,onChange:e=>$(e.target.value)},(0,a.createElement)("option",{value:"empty"},(0,o.__)("Chat","ai-gateway")),(0,a.createElement)("option",{value:"editor"},(0,o.__)("Editor","ai-gateway")),(0,a.createElement)("option",{value:"workflow"},(0,o.__)("Workflow","ai-gateway")),(0,a.createElement)("option",{value:"preview"},(0,o.__)("Preview","ai-gateway")),(0,a.createElement)("option",{value:"agents"},(0,o.__)("Agents","ai-gateway"))))),(0,a.createElement)("div",{className:"ai-studio-chat"},p.map((e,t)=>(0,a.createElement)("div",{key:t,className:`ai-studio-message ai-studio-${e.role}`},(0,a.createElement)("div",{className:"ai-studio-message-role"},e.role),(0,a.createElement)("div",{className:"ai-studio-message-content"},e.content))),ie&&(0,a.createElement)("div",{className:"ai-studio-typing"},be?.name||(0,o.__)("Agent","ai-gateway")," ",(0,o.__)("is typing...","ai-gateway"))),we.length>0&&(0,a.createElement)("div",{className:"ai-studio-error-log"},(0,a.createElement)("strong",null,(0,o.__)("Errors","ai-gateway")),we.map((e,t)=>(0,a.createElement)("div",{key:t,className:"ai-studio-error-item"},e.message))),Ne.length>0&&(0,a.createElement)("div",{className:"ai-studio-inputs"},Ne.map(e=>(0,a.createElement)("label",{key:e.key,className:"ai-studio-field"},(0,a.createElement)("span",null,e.label),(0,a.createElement)("input",{type:"number"===e.type?"number":"url"===e.type?"url":"text",value:m[e.key]||"",placeholder:e.placeholder,onChange:a=>u(t=>({...t,[e.key]:a.target.value}))})))),(0,a.createElement)("div",{className:"ai-studio-composer"},S&&(0,a.createElement)("div",{className:"ai-studio-error"},S),(0,a.createElement)("div",{className:"ai-studio-composer-row"},(0,a.createElement)("button",{className:"ai-studio-button icon",type:"button",title:(0,o.__)("Add","ai-gateway"),onClick:()=>L(e=>!e)},"+"),R&&(0,a.createElement)("div",{className:"ai-studio-plus-menu"},(0,a.createElement)("button",{type:"button",onClick:()=>{L(!1),$("tools")}},(0,o.__)("Tools","ai-gateway")),(0,a.createElement)("button",{type:"button",onClick:()=>{L(!1),$("upload")}},(0,o.__)("Upload image","ai-gateway")),(0,a.createElement)("button",{type:"button",onClick:()=>{L(!1),$("chain")}},(0,o.__)("Chain agents","ai-gateway"))),(0,a.createElement)("textarea",{className:"ai-studio-textarea",rows:"3",placeholder:(0,o.__)("Ask something...","ai-gateway"),value:r,onChange:e=>d(e.target.value)}),(0,a.createElement)("button",{className:"ai-studio-button",onClick:async()=>{if(!i)return void _e("No agent selected.");if(Z&&V.length>0)return void await Ae();k(!0),ne(!0),C("");const e=B.length?`${r}\n\nTools: ${B.join(", ")}`:r;let a=b;if(!a){const e=await s()({path:"/ai/v1/conversations",method:"POST",data:{name:"Conversation",project_id:w}});a=e.id,_(a=>[e,...a]),N(e.id)}const t={role:"user",content:r};g(e=>[...e,t,{role:"assistant",content:""}]),he(a,"user",e);try{const t=`${c.restUrl?c.restUrl.replace(/\/$/,""):"/wp-json/ai/v1"}/run/stream`,n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":c.nonce||""},body:JSON.stringify({agent_id:i,instruction:e,inputs:m})}),s=n.headers.get("content-type")||"";if(!n.ok||!n.body||!s.includes("text/event-stream"))throw new Error("Stream unavailable");const o=n.body.getReader(),l=new TextDecoder("utf-8");let r="";for(;;){const{value:e,done:t}=await o.read();if(t)break;r+=l.decode(e,{stream:!0});const i=r.split("\n\n");r=i.pop()||"",i.forEach(e=>{e.split("\n").forEach(e=>{if(!e.startsWith("data: "))return;const t=e.slice(6).trim();if(t)try{const e=JSON.parse(t);if(e.error)return void _e(e.error);e.delta&&Te(e.delta,!1),e.done&&e.full&&(Te(e.full,!0),he(a,"assistant",e.full),ne(!1))}catch(e){_e(e.message||"Stream parse error.")}})})}}catch(t){try{const t=await s()({path:"/ai/v1/run",method:"POST",data:{agent_id:i,instruction:e,inputs:m}});if(t?.error)_e(t.error);else{const e=t?.mcp_response||t?.ollama_response||"";Te(e,!0),he(a,"assistant",e)}}catch(e){_e(e.message||t.message||"Stream failed.")}}finally{k(!1),d(""),ne(!1)}},disabled:f},f?(0,o.__)("Running...","ai-gateway"):(0,o.__)("Send","ai-gateway"))),(0,a.createElement)("div",{className:"ai-studio-actions"},(0,a.createElement)("button",{className:"ai-studio-button secondary",onClick:Ce},(0,o.__)("Reset","ai-gateway")),(0,a.createElement)("label",{className:"ai-studio-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:Z,onChange:e=>ee(e.target.checked)}),(0,o.__)("Use chain","ai-gateway"))))),(0,a.createElement)("aside",{className:"ai-studio-workspace"},(0,a.createElement)("div",{className:"ai-studio-resizer",onMouseDown:()=>G(!0),title:(0,o.__)("Resize","ai-gateway")}),"agents"===P?(0,a.createElement)("iframe",{title:"Agents",className:"ai-studio-iframe",src:`${fe}admin.php?page=ai-gateway-agents&action=edit&agent_id=${i}&studio=1`}):"tools"===P?(0,a.createElement)("div",{className:"ai-studio-workspace-empty"},(0,o.__)("Tools panel (coming soon)","ai-gateway")):"upload"===P?(0,a.createElement)("div",{className:"ai-studio-workspace-panel"},(0,a.createElement)("h3",null,(0,o.__)("Upload image","ai-gateway")),(0,a.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>{if(!window.wp||!window.wp.media)return void _e("Media library not available.");const e=window.wp.media({title:"Select image",multiple:!1,library:{type:"image"}});e.on("select",()=>{const a=e.state().get("selection").first();if(!a)return;const t=a.toJSON();Q({id:t.id,url:t.url})}),e.open()}},(0,o.__)("Open Media Library","ai-gateway")),(0,a.createElement)("input",{className:"ai-studio-input",value:J,onChange:e=>z(e.target.value),placeholder:(0,o.__)("Image URL","ai-gateway")}),(0,a.createElement)("button",{className:"ai-studio-button",onClick:async()=>{H("");try{const e=await s()({path:"/ai/v1/media/import",method:"POST",data:{url:J}});H(e?.url?`Imported: ${e.url}`:"Imported"),e?.url&&Q({id:e.attachment_id,url:e.url})}catch(e){H(e.message||"Upload failed.")}}},(0,o.__)("Import","ai-gateway")),K?.url&&(0,a.createElement)("button",{className:"ai-studio-button",onClick:async()=>{let e=b;if(!e){const a=await s()({path:"/ai/v1/conversations",method:"POST",data:{name:"Conversation",project_id:w}});e=a.id,_(e=>[a,...e]),N(a.id)}const a=`![image](${K.url})`;g(e=>[...e,{role:"user",content:a}]),he(e,"user",a)}},(0,o.__)("Insert into chat","ai-gateway")),X&&(0,a.createElement)("div",{className:"ai-studio-sidebar-empty"},X)):"chain"===P?(0,a.createElement)("div",{className:"ai-studio-workspace-panel"},(0,a.createElement)("h3",null,(0,o.__)("Agent chain","ai-gateway")),e.map(e=>(0,a.createElement)("label",{key:e.id,className:"ai-studio-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:V.includes(e.id),onChange:a=>{const t=a.target.checked;Y(a=>t?[...a,e.id]:a.filter(a=>a!==e.id))}}),e.name)),(0,a.createElement)("button",{className:"ai-studio-button",onClick:Ae,disabled:f},(0,o.__)("Run chain","ai-gateway"))):"editor"===P?(0,a.createElement)("div",{className:"ai-studio-workspace-panel"},(0,a.createElement)("h3",null,(0,o.__)("Content editor","ai-gateway")),(0,a.createElement)("label",{className:"ai-studio-field"},(0,a.createElement)("span",null,(0,o.__)("Type","ai-gateway")),(0,a.createElement)("select",{className:"ai-studio-select",value:re,onChange:e=>de(e.target.value)},(0,a.createElement)("option",{value:"article"},(0,o.__)("Article","ai-gateway")),(0,a.createElement)("option",{value:"page"},(0,o.__)("Page","ai-gateway")),(0,a.createElement)("option",{value:"workflow"},(0,o.__)("Workflow","ai-gateway")))),(0,a.createElement)("label",{className:"ai-studio-field"},(0,a.createElement)("span",null,(0,o.__)("Title","ai-gateway")),(0,a.createElement)("input",{className:"ai-studio-input",value:me,onChange:e=>ue(e.target.value)})),(0,a.createElement)("label",{className:"ai-studio-field"},(0,a.createElement)("span",null,(0,o.__)("Content","ai-gateway")),(0,a.createElement)("textarea",{className:"ai-studio-textarea editor",rows:"8",value:pe,onChange:e=>ge(e.target.value)})),ye&&(0,a.createElement)("div",{className:"ai-studio-sidebar-empty"},ye),(0,a.createElement)("button",{className:"ai-studio-button",onClick:async()=>{ve("");try{const e="page"===re?"/wp/v2/pages":"/wp/v2/posts",a=await s()({path:e,method:"POST",data:{title:me||"Draft",content:pe,status:"draft"}});ve(`Draft created: #${a.id}`)}catch(e){ve(e.message||"Failed to create draft.")}}},(0,o.__)("Create draft","ai-gateway"))):"workflow"===P?(0,a.createElement)("div",{className:"ai-studio-workspace-empty"},(0,o.__)("Workflow editor (coming soon)","ai-gateway")):"preview"===P?(0,a.createElement)("div",{className:"ai-studio-workspace-empty"},(0,o.__)("Preview panel (coming soon)","ai-gateway")):(0,a.createElement)("div",{className:"ai-studio-workspace-empty"},(0,o.__)("Workspace","ai-gateway"))),O&&(0,a.createElement)("div",{className:"ai-studio-modal"},(0,a.createElement)("div",{className:"ai-studio-modal-card"},(0,a.createElement)("h3",null,(0,o.__)("Conversation actions","ai-gateway")),(0,a.createElement)("label",{className:"ai-studio-field"},(0,a.createElement)("span",null,(0,o.__)("Rename","ai-gateway")),(0,a.createElement)("input",{value:h.find(e=>e.id===O)?.name||"",onChange:e=>{const a=e.target.value;_(e=>e.map(e=>e.id===O?{...e,name:a}:e))}})),(0,a.createElement)("label",{className:"ai-studio-field"},(0,a.createElement)("span",null,(0,o.__)("Move to project","ai-gateway")),(0,a.createElement)("select",{className:"ai-studio-select",value:x,onChange:e=>D(Number(e.target.value))},(0,a.createElement)("option",{value:"0"},(0,o.__)("Select project","ai-gateway")),y.map(e=>(0,a.createElement)("option",{key:e.id,value:e.id},e.name)))),(0,a.createElement)("label",{className:"ai-studio-field"},(0,a.createElement)("span",null,(0,o.__)("Or create project","ai-gateway")),(0,a.createElement)("input",{value:M,onChange:e=>U(e.target.value),placeholder:(0,o.__)("New project name","ai-gateway")})),(0,a.createElement)("div",{className:"ai-studio-modal-actions"},(0,a.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{const e=h.find(e=>e.id===O)?.name||"";await s()({path:`/ai/v1/conversations/${O}`,method:"PUT",data:{name:e}}),j(null)}},(0,o.__)("Rename","ai-gateway")),(0,a.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{await(async e=>{let a=x;if(!a&&""!==M.trim()){const e=await s()({path:"/ai/v1/projects",method:"POST",data:{name:M.trim()}});v(a=>[e,...a]),a=e.id}a&&(await s()({path:`/ai/v1/conversations/${e}`,method:"PUT",data:{project_id:a}}),_(a=>a.filter(a=>a.id!==e)),b===e&&N(0))})(O),j(null)}},(0,o.__)("Move","ai-gateway")),(0,a.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{await(async e=>{await s()({path:`/ai/v1/conversations/${e}/archive`,method:"POST"}),_(a=>a.filter(a=>a.id!==e)),b===e&&N(0)})(O),j(null)}},(0,o.__)("Archive","ai-gateway")),(0,a.createElement)("button",{className:"ai-studio-button",onClick:async()=>{await(async e=>{await s()({path:`/ai/v1/conversations/${e}`,method:"DELETE"}),_(a=>a.filter(a=>a.id!==e)),b===e&&N(0)})(O),j(null)}},(0,o.__)("Delete","ai-gateway")),(0,a.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>j(null)},(0,o.__)("Cancel","ai-gateway"))))),se&&(0,a.createElement)("div",{className:"ai-studio-modal"},(0,a.createElement)("div",{className:"ai-studio-modal-card"},(0,a.createElement)("h3",null,(0,o.__)("Project actions","ai-gateway")),(0,a.createElement)("label",{className:"ai-studio-field"},(0,a.createElement)("span",null,(0,o.__)("Rename","ai-gateway")),(0,a.createElement)("input",{value:le,onChange:e=>ce(e.target.value)})),(0,a.createElement)("div",{className:"ai-studio-modal-actions"},(0,a.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{await s()({path:`/ai/v1/projects/${w}`,method:"PUT",data:{name:le}}),v(e=>e.map(e=>e.id===w?{...e,name:le}:e)),oe(!1)}},(0,o.__)("Rename","ai-gateway")),(0,a.createElement)("button",{className:"ai-studio-button",onClick:async()=>{await s()({path:`/ai/v1/projects/${w}`,method:"DELETE"}),v(e=>e.filter(e=>e.id!==w)),E(0),oe(!1)}},(0,o.__)("Delete","ai-gateway")),(0,a.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>oe(!1)},(0,o.__)("Cancel","ai-gateway"))))),T&&(0,a.createElement)("div",{className:"ai-studio-modal"},(0,a.createElement)("div",{className:"ai-studio-modal-card large"},(0,a.createElement)("div",{className:"ai-studio-modal-header"},(0,a.createElement)("h3",null,(0,o.__)("Settings","ai-gateway")),(0,a.createElement)("button",{className:"ai-studio-icon-button",onClick:()=>A(!1)},"✕")),(0,a.createElement)("iframe",{title:"Settings",className:"ai-studio-iframe",src:`${fe}admin.php?page=ai-gateway-settings&studio=1`}))))}c.nonce&&s().use(s().createNonceMiddleware(c.nonce)),(0,t.registerBlockType)("ai-gateway/studio",{title:(0,o.__)("AI Studio","ai-gateway"),icon:"format-chat",category:"widgets",edit(){const e=(0,i.useBlockProps)({className:"ai-studio-block-placeholder"});return(0,a.createElement)("div",{...e},(0,o.__)("AI Studio App","ai-gateway"))},save(){const e=i.useBlockProps.save({className:"ai-studio-app"});return(0,a.createElement)("div",{...e})}});const d=()=>{const e=document.querySelectorAll(".ai-studio-app");e.length&&e.forEach(e=>{window.wp.element.render((0,a.createElement)(r,null),e)})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d()})();