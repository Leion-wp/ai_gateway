(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var i in a)e.o(a,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:a[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.blocks,i=window.wp.blockEditor,n=window.wp.apiFetch;var s=e.n(n);const o=window.wp.i18n,l=window.wp.element,r=window.AIGatewaySettings||{restUrl:"",nonce:"",agents:[]};r.nonce&&s().use(s().createNonceMiddleware(r.nonce));const c=[{match:/seo|keywords|rank\s*math|yoast/i,tools:["SEO"]},{match:/rewrite|rephrase|improve|ameliore|améliore|reformule/i,tools:["Rewrite"]},{match:/outline|plan|structure/i,tools:["Outline"]},{match:/summary|summarize|resume|résume/i,tools:["Summarize"]},{match:/ui|design|layout|dark\s*mode/i,tools:["UI Changer","UI Builder"]},{match:/faq/i,tools:["FAQ Builder"]},{match:/cta|call to action/i,tools:["CTA Builder"]}],d=()=>`node_${Date.now()}_${Math.floor(1e3*Math.random())}`,u=e=>(Array.isArray(e)?e:[]).map((e,t)=>{const a=40+40*t,i=40+100*t;return{id:e.id||d(),type:e.type||"run_agent",x:Number.isFinite(e.x)?e.x:a,y:Number.isFinite(e.y)?e.y:i,...e}});function m(){const[e,a]=(0,l.useState)(r.agents||[]),[i,n]=(0,l.useState)(r.studioDefaultAgent||r.agents?.[0]?.id||0),[m,p]=(0,l.useState)(""),[w,g]=(0,l.useState)({}),[y,v]=(0,l.useState)([]),[_,h]=(0,l.useState)([]),[E,f]=(0,l.useState)(0),[b,N]=(0,l.useState)([]),[k,S]=(0,l.useState)(0),[C,$]=(0,l.useState)(!1),[T,P]=(0,l.useState)(""),[D,x]=(0,l.useState)(!1),[A,I]=(0,l.useState)(window.localStorage.getItem("ai_gateway_workspace_mode")||"chat"),[O,j]=(0,l.useState)(null),[M,U]=(0,l.useState)(0),[F,R]=(0,l.useState)(""),[L,W]=(0,l.useState)(!1),[B,G]=(0,l.useState)(Number(window.localStorage.getItem("ai_gateway_workspace_width"))||360),[q,X]=(0,l.useState)(!1),[z,V]=(0,l.useState)([]),[Y,J]=(0,l.useState)(""),[Q,H]=(0,l.useState)(""),[K,Z]=(0,l.useState)(null),[ee,te]=(0,l.useState)([]),[ae,ie]=(0,l.useState)(!1),[ne,se]=(0,l.useState)(!1),[oe,le]=(0,l.useState)(!1),[re,ce]=(0,l.useState)(!1),[de,ue]=(0,l.useState)(""),[me,pe]=(0,l.useState)("article"),[we,ge]=(0,l.useState)(""),[ye,ve]=(0,l.useState)(""),[_e,he]=(0,l.useState)(""),[Ee,fe]=(0,l.useState)("append"),[be,Ne]=(0,l.useState)("article"),[ke,Se]=(0,l.useState)(""),[Ce,$e]=(0,l.useState)(!0),[Te,Pe]=(0,l.useState)(""),[De,xe]=(0,l.useState)([]),[Ae,Ie]=(0,l.useState)([]),[Oe,je]=(0,l.useState)("article"),[Me,Ue]=(0,l.useState)(""),[Fe,Re]=(0,l.useState)(""),[Le,We]=(0,l.useState)([]),[Be,Ge]=(0,l.useState)(0),[qe,Xe]=(0,l.useState)(""),[ze,Ve]=(0,l.useState)([]),[Ye,Je]=(0,l.useState)(""),[Qe,He]=(0,l.useState)([]),[Ke,Ze]=(0,l.useState)(""),[et,tt]=(0,l.useState)(null),at=(0,l.useRef)([]),it=async(e,t,a)=>{if(e)try{await s()({path:`/ai/v1/conversations/${e}/messages`,method:"POST",data:{role:t,content:a}})}catch(e){nt(e.message||"Failed to save message.")}},nt=e=>{P(e),We(t=>[{message:e,time:(new Date).toISOString()},...t.slice(0,9)])},st=(0,l.useMemo)(()=>e.find(e=>e.id===i),[e,i]),ot=(e=>(e||[]).map(e=>"string"==typeof e?{key:e,label:e,type:"text"}:e&&e.key?{key:e.key,label:e.label||e.key,type:e.type||"text",options:e.options||[],placeholder:e.placeholder||"",required:Boolean(e.required),env:e.env||""}:null).filter(Boolean))(st?.input_schema||[]).filter(e=>!e.env),lt=r.adminUrl||"/wp-admin/",rt=st?.tools||[],ct=(0,l.useMemo)(()=>{const t={};return e.forEach(e=>{t[e.id]=e}),t},[e]),dt=()=>{const e={};ot.forEach(t=>{e[t.key]=""}),g(e)},ut=()=>{const e=b.find(e=>e.id===k);return e?.name||"Draft"},mt=()=>{const e=[...y].reverse().find(e=>"assistant"===e.role);if(e?.content)return e.content;const t=[...y].reverse().find(e=>"user"===e.role);return t?.content?t.content:m||""},pt=async(e,t,a)=>{const i="page"===e?"/wp/v2/pages":"/wp/v2/posts",n=await s()({path:i,method:"POST",data:{title:t||"Draft",content:a,status:"draft"}});if(Ge(n?.id||0),n?.id){const a=`${t||"Draft"} (ID: ${n.id})`;await s()({path:`${i}/${n.id}`,method:"POST",data:{title:a}}),Xe("page"===e?`${window.location.origin}/?page_id=${n.id}&preview=true`:`${window.location.origin}/?p=${n.id}&preview=true`)}return n},wt=async(e,t,a,i,n,o)=>{if(!t)throw new Error("Post ID required.");const l="page"===e?`/wp/v2/pages/${t}`:`/wp/v2/posts/${t}`,r={content:i};return a&&(r.title=a),n&&(r.status=n),o&&(r.date=o),s()({path:l,method:"POST",data:r})};(0,l.useEffect)(()=>{if(e.length)return;let t=!0;return(async()=>{try{const e=await s()({path:"/ai/v1/agents?enabled=1",method:"GET"});if(!t)return;const i=Array.isArray(e)?e:[];a(i);const o=r.studioDefaultAgent||0,l=i.find(e=>e.id===o);n(l?.id||i[0]?.id||0)}catch(e){t&&nt(e.message||"Failed to load agents.")}})(),()=>{t=!1}},[e.length]),(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{const t=await s()({path:"/ai/v1/plugins",method:"GET"});if(!e)return;const a=(Array.isArray(t)?t:[]).map(e=>({name:e.name,active:Boolean(e.active)})).filter(e=>/yoast|rank\s*math|ewww/i.test(e.name||"")).map(e=>({...e,tool:e.name}));xe(a)}catch(e){nt(e.message||"Failed to load plugins.")}})(),()=>{e=!1}},[]),(0,l.useEffect)(()=>{dt(),V(st?.tools||[])},[i]),(0,l.useEffect)(()=>{if(!q)return;const e=e=>{const t=Math.min(640,Math.max(260,window.innerWidth-e.clientX-24));G(t)},t=()=>{X(!1)};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[q]),(0,l.useEffect)(()=>{if(!et)return;const e=e=>{const t=document.querySelector(".ai-studio-workflow-canvas");if(!t)return;const a=t.getBoundingClientRect(),i=e.clientX-a.left-et.offsetX,n=e.clientY-a.top-et.offsetY;Ve(e=>e.map(e=>e.id===et.id?{...e,x:Math.max(20,i),y:Math.max(20,n)}:e))},t=()=>{tt(null),vt(at.current)};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[et]),(0,l.useEffect)(()=>{window.localStorage.setItem("ai_gateway_workspace_mode",A)},[A]),(0,l.useEffect)(()=>{window.localStorage.setItem("ai_gateway_workspace_width",String(B))},[B]),(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{const t=await s()({path:"/ai/v1/projects",method:"GET"}),a=Array.isArray(t)?t:[];if(!e)return;if(!a.length){const e=await s()({path:"/ai/v1/projects",method:"POST",data:{name:"General"}});return h([e]),void f(e.id)}h(a),f(a[0]?.id||0)}catch(t){e&&nt(t.message||"Failed to load projects.")}})(),()=>{e=!1}},[]),(0,l.useEffect)(()=>{if(!E)return;let e=!0;return(async()=>{try{const t=await s()({path:`/ai/v1/conversations?project_id=${E}&include_archived=${ne?"1":"0"}`,method:"GET"});if(!e)return;const a=Array.isArray(t)?t:[];N(a),S(a[0]?.id||0)}catch(t){e&&nt(t.message||"Failed to load conversations.")}})(),()=>{e=!1}},[E,ne]),(0,l.useEffect)(()=>{if(!k)return void v([]);let e=!0;return(async()=>{try{const t=await s()({path:`/ai/v1/conversations/${k}`,method:"GET"});e&&t?.messages&&v(t.messages)}catch(t){e&&nt(t.message||"Failed to load conversation.")}})(),()=>{e=!1}},[k]),(0,l.useEffect)(()=>{if(!k)return void Ve([]);let e=!0;return(async()=>{try{const t=await s()({path:`/ai/v1/conversations/${k}/workflow`,method:"GET"});e&&(Ve(u(t?.workflow)),He(Array.isArray(t?.versions)?t.versions:[]))}catch(e){nt(e.message||"Failed to load workflow.")}})(),()=>{e=!1}},[k]),(0,l.useEffect)(()=>{at.current=ze},[ze]);const gt=(e,t)=>{v(a=>{if(!a.length)return a;const i=[...a],n=i[i.length-1];return"assistant"!==n.role?a:(i[i.length-1]={...n,content:t?e:n.content+e},i)})},yt=async()=>{$(!0),le(!0),P("");const e=z.length?`${m}\n\nTools: ${z.join(", ")}`:m;let t=k;if(!t){const e=await s()({path:"/ai/v1/conversations",method:"POST",data:{name:"Conversation",project_id:E}});t=e.id,N(t=>[e,...t]),S(e.id)}v(e=>[...e,{role:"user",content:m}]),it(t,"user",e);try{for(const a of ee){const i=await s()({path:"/ai/v1/run",method:"POST",data:{agent_id:a,instruction:e,inputs:w}}),n=i?.mcp_response||i?.ollama_response||i?.error||"",o=`${ct[a]?.name||"Agent"}: ${n}`;v(e=>[...e,{role:"assistant",content:o}]),it(t,"assistant",o)}}catch(e){nt(e.message||"Chain failed.")}finally{$(!1),le(!1),p("")}},vt=async(e,t={})=>{if(!k)return;const a={workflow:e};t.saveVersion&&(a.save_version=!0,a.note=t.note||"");const i=await s()({path:`/ai/v1/conversations/${k}/workflow`,method:"POST",data:a});i?.versions&&He(i.versions)};(0,l.useEffect)(()=>{if(!k||0===y.length)return;const e=setTimeout(async()=>{try{await s()({path:`/ai/v1/conversations/${k}/draft`,method:"POST",data:{messages:y}})}catch(e){nt(e.message||"Failed to save draft.")}},1200);return()=>clearTimeout(e)},[k,y]);const _t=(0,l.useMemo)(()=>{const e=ze.reduce((e,t)=>Math.max(e,t.x||0),0),t=ze.reduce((e,t)=>Math.max(e,t.y||0),0);return{width:Math.max(520,e+240+80),height:Math.max(360,t+140+80)}},[ze]),ht=e=>{const t=ze.length,a=[...ze,{id:d(),x:40+40*t,y:40+100*t,...e}];Ve(a),vt(a)},Et=(e,t)=>{const a=[...ze],i=e+t;if(i<0||i>=a.length)return;const[n]=a.splice(e,1);a.splice(i,0,n),Ve(a),vt(a)};return(0,t.createElement)("div",{className:"ai-studio-app",style:{gridTemplateColumns:`280px 1fr ${B}px`}},(0,t.createElement)("aside",{className:"ai-studio-sidebar"},(0,t.createElement)("div",{className:"ai-studio-sidebar-section"},(0,t.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Projects","ai-gateway")),(0,t.createElement)("div",{className:"ai-studio-project-row"},(0,t.createElement)("select",{className:"ai-studio-select",value:E,onChange:e=>f(Number(e.target.value))},_.map(e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.name))),(0,t.createElement)("button",{type:"button",className:"ai-studio-icon-button",onClick:()=>{ce(!0);const e=_.find(e=>e.id===E);ue(e?.name||"")}},"..."))),(0,t.createElement)("div",{className:"ai-studio-sidebar-section"},(0,t.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Conversations","ai-gateway")),(0,t.createElement)("label",{className:"ai-studio-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:ne,onChange:e=>se(e.target.checked)}),(0,o.__)("Show archived","ai-gateway")),(0,t.createElement)("div",{className:"ai-studio-conversation-list"},b.map(e=>(0,t.createElement)("div",{key:e.id,className:"ai-studio-conversation-row"},(0,t.createElement)("button",{type:"button",className:"ai-studio-conversation "+(e.id===k?"active":""),onClick:()=>S(e.id)},(0,t.createElement)("div",{className:"ai-studio-conversation-title"},e.name),e.archived&&(0,t.createElement)("div",{className:"ai-studio-conversation-last"},(0,o.__)("Archived","ai-gateway")),e.last&&(0,t.createElement)("div",{className:"ai-studio-conversation-last"},e.last)),(0,t.createElement)("button",{type:"button",className:"ai-studio-icon-button",onClick:()=>{j(e.id),U(0),R("")}},"...")))),(0,t.createElement)("button",{type:"button",className:"ai-studio-button secondary",onClick:async()=>{const e=await s()({path:"/ai/v1/conversations",method:"POST",data:{name:"Conversation",project_id:E}});N(t=>[e,...t]),S(e.id)}},(0,o.__)("New chat","ai-gateway"))),(0,t.createElement)("div",{className:"ai-studio-sidebar-section"},(0,t.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Agents","ai-gateway")),(0,t.createElement)("select",{className:"ai-studio-select",value:i,onChange:e=>n(Number(e.target.value))},e.map(e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.name)))),(0,t.createElement)("div",{className:"ai-studio-sidebar-section"},(0,t.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Tools","ai-gateway")),0===rt.length&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},(0,o.__)("Assigned via agent.","ai-gateway")),rt.map(e=>(0,t.createElement)("label",{key:e,className:"ai-studio-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:z.includes(e),onChange:t=>{const a=t.target.checked;V(t=>a?[...t,e]:t.filter(t=>t!==e))}}),e))),De.length>0&&(0,t.createElement)("div",{className:"ai-studio-sidebar-section"},(0,t.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Plugin tools","ai-gateway")),De.map(e=>(0,t.createElement)("label",{key:e.tool,className:"ai-studio-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:Ae.includes(e.tool),disabled:!e.active,onChange:t=>{const a=t.target.checked;Ie(t=>a?[...t,e.tool]:t.filter(t=>t!==e.tool))}}),e.name," ",e.active?"":(0,o.__)("(inactive)","ai-gateway")))),(0,t.createElement)("div",{className:"ai-studio-sidebar-section"},(0,t.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Settings","ai-gateway")),(0,t.createElement)("button",{type:"button",className:"ai-studio-button secondary",onClick:()=>x(!0)},(0,o.__)("Open settings","ai-gateway")),(0,t.createElement)("button",{type:"button",className:"ai-studio-button secondary",onClick:()=>I("agents")},(0,o.__)("Agents editor","ai-gateway")),(0,t.createElement)("button",{type:"button",className:"ai-studio-button secondary",onClick:()=>I("admin")},(0,o.__)("WP Admin","ai-gateway")))),(0,t.createElement)("main",{className:"ai-studio-main"},(0,t.createElement)("div",{className:"ai-studio-topbar"},(0,t.createElement)("div",{className:"ai-studio-topbar-left"},(0,t.createElement)("span",{className:"ai-studio-topbar-label"},(0,o.__)("Active agent","ai-gateway")),(0,t.createElement)("span",{className:"ai-studio-topbar-value"},st?.name||(0,o.__)("None","ai-gateway"))),(0,t.createElement)("div",{className:"ai-studio-topbar-right"},(0,t.createElement)("span",{className:"ai-studio-status-dot"}),(0,t.createElement)("span",null,(0,o.__)("Ollama: online","ai-gateway")),(0,t.createElement)("div",{className:"ai-studio-tabs"},[{id:"chat",label:(0,o.__)("Chat","ai-gateway")},{id:"editor",label:(0,o.__)("Editor","ai-gateway")},{id:"split",label:(0,o.__)("Split","ai-gateway")},{id:"workflow",label:(0,o.__)("Workflow","ai-gateway")},{id:"preview",label:(0,o.__)("Preview","ai-gateway")},{id:"agents",label:(0,o.__)("Agents","ai-gateway")},{id:"admin",label:(0,o.__)("WP Admin","ai-gateway")}].map(e=>(0,t.createElement)("button",{key:e.id,className:"ai-studio-tab "+(A===e.id?"active":""),onClick:()=>I(e.id)},e.label))))),(0,t.createElement)("div",{className:"ai-studio-chat"},y.map((e,a)=>(0,t.createElement)("div",{key:a,className:`ai-studio-message ai-studio-${e.role}`},(0,t.createElement)("div",{className:"ai-studio-message-role"},e.role),(0,t.createElement)("div",{className:"ai-studio-message-content"},e.content))),oe&&(0,t.createElement)("div",{className:"ai-studio-typing"},st?.name||(0,o.__)("Agent","ai-gateway")," ",(0,o.__)("is typing...","ai-gateway"))),Le.length>0&&(0,t.createElement)("div",{className:"ai-studio-error-log"},(0,t.createElement)("strong",null,(0,o.__)("Errors","ai-gateway")),Le.map((e,a)=>(0,t.createElement)("div",{key:a,className:"ai-studio-error-item"},e.message))),ot.length>0&&(0,t.createElement)("div",{className:"ai-studio-inputs"},ot.map(e=>(0,t.createElement)("label",{key:e.key,className:"ai-studio-field"},(0,t.createElement)("span",null,e.label),(0,t.createElement)("input",{type:"number"===e.type?"number":"url"===e.type?"url":"text",value:w[e.key]||"",placeholder:e.placeholder,onChange:t=>g(a=>({...a,[e.key]:t.target.value}))})))),(0,t.createElement)("div",{className:"ai-studio-composer"},T&&(0,t.createElement)("div",{className:"ai-studio-error"},T),(0,t.createElement)("div",{className:"ai-studio-composer-row"},(0,t.createElement)("button",{className:"ai-studio-button icon",type:"button",title:(0,o.__)("Add","ai-gateway"),onClick:()=>W(e=>!e)},"+"),L&&(0,t.createElement)("div",{className:"ai-studio-plus-menu"},(0,t.createElement)("button",{type:"button",onClick:()=>{W(!1),I("tools")}},(0,o.__)("Tools","ai-gateway")),(0,t.createElement)("button",{type:"button",onClick:()=>{W(!1),I("upload")}},(0,o.__)("Upload image","ai-gateway")),(0,t.createElement)("button",{type:"button",onClick:()=>{W(!1),I("chain")}},(0,o.__)("Chain agents","ai-gateway"))),(0,t.createElement)("textarea",{className:"ai-studio-textarea",rows:"3",placeholder:(0,o.__)("Ask something...","ai-gateway"),value:m,onChange:e=>p(e.target.value)}),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{if(!i)return void nt("No agent selected.");if(ae&&ee.length>0)return void await yt();$(!0),le(!0),P("");let e=z;if(Ce&&m){const t=(e=>{const t=e||"",a=c.filter(e=>e.match.test(t)).flatMap(e=>e.tools),i=/page|landing|homepage|accueil/i.test(t)?"page":"article";return{intent:/publish|post|article|page|create|ecrire|écrire/i.test(t)?"create":"chat",createType:i,tools:[...new Set(a)]}})(m);Pe(t.tools.length?t.tools.join(", "):""),Ne(t.createType),e=(e=>{if(!e?.tools?.length)return z;const t=rt.length?rt:[],a=[...new Set([...z,...e.tools])],i=t.length?a.filter(e=>t.includes(e)):a;return V(i),i})(t)}const t=Ae.length?`\n\nPlugins: ${Ae.join(", ")}`:"",a=e.length?`${m}\n\nTools: ${e.join(", ")}${t}`:`${m}${t}`;let n=k;if(!n){const e=await s()({path:"/ai/v1/conversations",method:"POST",data:{name:"Conversation",project_id:E}});n=e.id,N(t=>[e,...t]),S(e.id)}const o={role:"user",content:m};v(e=>[...e,o,{role:"assistant",content:""}]),it(n,"user",a);try{const e=`${r.restUrl?r.restUrl.replace(/\/$/,""):"/wp-json/ai/v1"}/run/stream`,t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":r.nonce||""},body:JSON.stringify({agent_id:i,instruction:a,inputs:w})}),s=t.headers.get("content-type")||"";if(!t.ok||!t.body||!s.includes("text/event-stream"))throw new Error("Stream unavailable");const o=t.body.getReader(),l=new TextDecoder("utf-8");let c="";for(;;){const{value:e,done:t}=await o.read();if(t)break;c+=l.decode(e,{stream:!0});const a=c.split("\n\n");c=a.pop()||"",a.forEach(e=>{e.split("\n").forEach(e=>{if(!e.startsWith("data: "))return;const t=e.slice(6).trim();if(t)try{const e=JSON.parse(t);if(e.error)return void nt(e.error);e.delta&&gt(e.delta,!1),e.done&&e.full&&(gt(e.full,!0),it(n,"assistant",e.full),le(!1))}catch(e){nt(e.message||"Stream parse error.")}})})}}catch(e){try{const e=await s()({path:"/ai/v1/run",method:"POST",data:{agent_id:i,instruction:a,inputs:w}});if(e?.error)nt(e.error);else{const t=e?.mcp_response||e?.ollama_response||"";gt(t,!0),it(n,"assistant",t)}}catch(t){nt(t.message||e.message||"Stream failed.")}}finally{$(!1),p(""),le(!1)}},disabled:C},C?(0,o.__)("Running...","ai-gateway"):(0,o.__)("Send","ai-gateway"))),(0,t.createElement)("div",{className:"ai-studio-actions"},(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:dt},(0,o.__)("Reset","ai-gateway")),(0,t.createElement)("label",{className:"ai-studio-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:ae,onChange:e=>ie(e.target.checked)}),(0,o.__)("Use chain","ai-gateway")),(0,t.createElement)("label",{className:"ai-studio-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:Ce,onChange:e=>$e(e.target.checked)}),(0,o.__)("Auto intent","ai-gateway"))),(0,t.createElement)("div",{className:"ai-studio-chat-tools"},(0,t.createElement)("div",{className:"ai-studio-sidebar-title"},(0,o.__)("Chat tools","ai-gateway")),(0,t.createElement)("div",{className:"ai-studio-chat-tools-row"},(0,t.createElement)("select",{className:"ai-studio-select",value:Ee,onChange:e=>fe(e.target.value)},(0,t.createElement)("option",{value:"append"},(0,o.__)("Append to editor","ai-gateway")),(0,t.createElement)("option",{value:"replace"},(0,o.__)("Replace editor","ai-gateway")),(0,t.createElement)("option",{value:"section"},(0,o.__)("Add as section","ai-gateway"))),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>{const e=mt();if(!e)return void nt("No chat content to inject.");const t=we||ut();let a="";a="replace"===Ee?e:"section"===Ee?ye?`${ye}\n\n## ${t}\n\n${e}`:`## ${t}\n\n${e}`:ye?`${ye}\n\n${e}`:e,ge(t),ve(a),I("editor"),Se("Injected into editor.")}},(0,o.__)("Inject into editor","ai-gateway"))),(0,t.createElement)("div",{className:"ai-studio-chat-tools-row"},(0,t.createElement)("select",{className:"ai-studio-select",value:be,onChange:e=>Ne(e.target.value)},(0,t.createElement)("option",{value:"article"},(0,o.__)("Create article","ai-gateway")),(0,t.createElement)("option",{value:"page"},(0,o.__)("Create page","ai-gateway"))),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{const e=mt();if(!e)return void nt("No chat content to create draft.");const t=we||ut();Se(""),he(""),I("editor"),pe(be),ge(t),ve(e);try{const a=await pt(be,t,e);he(`Draft created: #${a.id}`),Se(`Draft created: #${a.id}`)}catch(e){const t=e.message||"Failed to create draft.";he(t),Se(t)}}},(0,o.__)("Create from chat","ai-gateway"))),(0,t.createElement)("div",{className:"ai-studio-chat-tools-row"},(0,t.createElement)("select",{className:"ai-studio-select",value:Oe,onChange:e=>je(e.target.value)},(0,t.createElement)("option",{value:"article"},(0,o.__)("Update article","ai-gateway")),(0,t.createElement)("option",{value:"page"},(0,o.__)("Update page","ai-gateway"))),(0,t.createElement)("input",{className:"ai-studio-input",value:Me,onChange:e=>Ue(e.target.value),placeholder:(0,o.__)("Post ID","ai-gateway")}),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{const e=mt();if(e)if(Me){Se("");try{await wt(Oe,Number(Me),we,e),Se(`Post updated: #${Me}`),Xe("page"===Oe?`${window.location.origin}/?page_id=${Me}&preview=true`:`${window.location.origin}/?p=${Me}&preview=true`)}catch(e){Se(e.message||"Failed to update post.")}}else nt("Post ID is required.");else nt("No chat content to update post.")}},(0,o.__)("Update from chat","ai-gateway"))),Te&&Ce&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},(0,o.__)("Intent tools:","ai-gateway")," ",Te),ke&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},ke)))),(0,t.createElement)("aside",{className:"ai-studio-workspace"},(0,t.createElement)("div",{className:"ai-studio-resizer",onMouseDown:()=>X(!0),title:(0,o.__)("Resize","ai-gateway")}),"agents"===A?(0,t.createElement)("iframe",{title:"Agents",className:"ai-studio-iframe",src:`${lt}admin.php?page=ai-gateway-agents&action=edit&agent_id=${i}&studio=1`}):"admin"===A?(0,t.createElement)("iframe",{title:"WP Admin",className:"ai-studio-iframe",src:`${lt}admin.php`}):"tools"===A?(0,t.createElement)("div",{className:"ai-studio-workspace-empty"},(0,o.__)("Tools panel (coming soon)","ai-gateway")):"upload"===A?(0,t.createElement)("div",{className:"ai-studio-workspace-panel"},(0,t.createElement)("h3",null,(0,o.__)("Upload image","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>{if(!window.wp||!window.wp.media)return void nt("Media library not available.");const e=window.wp.media({title:"Select image",multiple:!1,library:{type:"image"}});e.on("select",()=>{const t=e.state().get("selection").first();if(!t)return;const a=t.toJSON();Z({id:a.id,url:a.url})}),e.open()}},(0,o.__)("Open Media Library","ai-gateway")),(0,t.createElement)("input",{className:"ai-studio-input",value:Y,onChange:e=>J(e.target.value),placeholder:(0,o.__)("Image URL","ai-gateway")}),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{H("");try{const e=await s()({path:"/ai/v1/media/import",method:"POST",data:{url:Y}});H(e?.url?`Imported: ${e.url}`:"Imported"),e?.url&&Z({id:e.attachment_id,url:e.url})}catch(e){H(e.message||"Upload failed.")}}},(0,o.__)("Import","ai-gateway")),K?.url&&(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{let e=k;if(!e){const t=await s()({path:"/ai/v1/conversations",method:"POST",data:{name:"Conversation",project_id:E}});e=t.id,N(e=>[t,...e]),S(t.id)}const t=`![image](${K.url})`;v(e=>[...e,{role:"user",content:t}]),it(e,"user",t)}},(0,o.__)("Insert into chat","ai-gateway")),Q&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},Q)):"chain"===A?(0,t.createElement)("div",{className:"ai-studio-workspace-panel"},(0,t.createElement)("h3",null,(0,o.__)("Agent chain","ai-gateway")),e.map(e=>(0,t.createElement)("label",{key:e.id,className:"ai-studio-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:ee.includes(e.id),onChange:t=>{const a=t.target.checked;te(t=>a?[...t,e.id]:t.filter(t=>t!==e.id))}}),e.name)),(0,t.createElement)("button",{className:"ai-studio-button",onClick:yt,disabled:C},(0,o.__)("Run chain","ai-gateway"))):"editor"===A?(0,t.createElement)("div",{className:"ai-studio-workspace-panel"},(0,t.createElement)("h3",null,(0,o.__)("Content editor","ai-gateway")),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Type","ai-gateway")),(0,t.createElement)("select",{className:"ai-studio-select",value:me,onChange:e=>pe(e.target.value)},(0,t.createElement)("option",{value:"article"},(0,o.__)("Article","ai-gateway")),(0,t.createElement)("option",{value:"page"},(0,o.__)("Page","ai-gateway")),(0,t.createElement)("option",{value:"workflow"},(0,o.__)("Workflow","ai-gateway")))),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Title","ai-gateway")),(0,t.createElement)("input",{className:"ai-studio-input",value:we,onChange:e=>ge(e.target.value)})),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Content","ai-gateway")),(0,t.createElement)("textarea",{className:"ai-studio-textarea editor",rows:"8",value:ye,onChange:e=>ve(e.target.value)})),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Publish at (optional)","ai-gateway")),(0,t.createElement)("input",{className:"ai-studio-input",type:"datetime-local",value:Fe,onChange:e=>Re(e.target.value)})),_e&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},_e),Be>0&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},`Draft ID: ${Be}`),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{he("");try{const e=await pt(me,we,ye);he(`Draft created: #${e.id}`)}catch(e){he(e.message||"Failed to create draft.")}}},(0,o.__)("Create draft","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>{const e=[...y].reverse().find(e=>"assistant"===e.role);e&&ve(e.content)}},(0,o.__)("Use last assistant","ai-gateway")),Be>0&&(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{he("");try{const e="page"===me?`/wp/v2/pages/${Be}`:`/wp/v2/posts/${Be}`;await s()({path:e,method:"POST",data:{title:`${we||"Draft"} (ID: ${Be})`,content:ye}}),he("Draft updated.")}catch(e){he(e.message||"Failed to update draft.")}}},(0,o.__)("Update draft","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{he("");try{const e=Fe?"future":"publish",t=Fe?new Date(Fe).toISOString():null,a=Be||Me;if(!a)return void he("No draft/post selected.");await wt(me,Number(a),we,ye,e,t),he(Fe?"Scheduled.":"Published."),Xe("page"===me?`${window.location.origin}/?page_id=${a}&preview=true`:`${window.location.origin}/?p=${a}&preview=true`)}catch(e){he(e.message||"Failed to publish.")}}},Fe?(0,o.__)("Schedule","ai-gateway"):(0,o.__)("Publish now","ai-gateway")),qe&&(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>I("preview")},(0,o.__)("Open preview","ai-gateway"))):"split"===A?(0,t.createElement)("div",{className:"ai-studio-workspace-panel split"},(0,t.createElement)("div",{className:"ai-studio-split-panel"},(0,t.createElement)("h3",null,(0,o.__)("Content editor","ai-gateway")),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Type","ai-gateway")),(0,t.createElement)("select",{className:"ai-studio-select",value:me,onChange:e=>pe(e.target.value)},(0,t.createElement)("option",{value:"article"},(0,o.__)("Article","ai-gateway")),(0,t.createElement)("option",{value:"page"},(0,o.__)("Page","ai-gateway")),(0,t.createElement)("option",{value:"workflow"},(0,o.__)("Workflow","ai-gateway")))),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Title","ai-gateway")),(0,t.createElement)("input",{className:"ai-studio-input",value:we,onChange:e=>ge(e.target.value)})),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Content","ai-gateway")),(0,t.createElement)("textarea",{className:"ai-studio-textarea editor",rows:"8",value:ye,onChange:e=>ve(e.target.value)})),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Publish at (optional)","ai-gateway")),(0,t.createElement)("input",{className:"ai-studio-input",type:"datetime-local",value:Fe,onChange:e=>Re(e.target.value)})),_e&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},_e),Be>0&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},`Draft ID: ${Be}`),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{he("");try{const e=await pt(me,we,ye);he(`Draft created: #${e.id}`)}catch(e){he(e.message||"Failed to create draft.")}}},(0,o.__)("Create draft","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>{const e=[...y].reverse().find(e=>"assistant"===e.role);e&&ve(e.content)}},(0,o.__)("Use last assistant","ai-gateway")),Be>0&&(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{he("");try{const e="page"===me?`/wp/v2/pages/${Be}`:`/wp/v2/posts/${Be}`;await s()({path:e,method:"POST",data:{title:`${we||"Draft"} (ID: ${Be})`,content:ye}}),he("Draft updated.")}catch(e){he(e.message||"Failed to update draft.")}}},(0,o.__)("Update draft","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{he("");try{const e=Fe?"future":"publish",t=Fe?new Date(Fe).toISOString():null,a=Be||Me;if(!a)return void he("No draft/post selected.");await wt(me,Number(a),we,ye,e,t),he(Fe?"Scheduled.":"Published."),Xe("page"===me?`${window.location.origin}/?page_id=${a}&preview=true`:`${window.location.origin}/?p=${a}&preview=true`)}catch(e){he(e.message||"Failed to publish.")}}},Fe?(0,o.__)("Schedule","ai-gateway"):(0,o.__)("Publish now","ai-gateway"))),(0,t.createElement)("div",{className:"ai-studio-split-panel"},(0,t.createElement)("h3",null,(0,o.__)("Preview","ai-gateway")),qe?(0,t.createElement)("iframe",{title:"Preview",className:"ai-studio-iframe",src:qe}):(0,t.createElement)("div",{className:"ai-studio-workspace-empty"},(0,o.__)("No preview yet.","ai-gateway")))):"workflow"===A?(0,t.createElement)("div",{className:"ai-studio-workspace-panel"},(0,t.createElement)("div",{className:"ai-studio-workflow-header"},(0,t.createElement)("h3",null,(0,o.__)("Workflow builder","ai-gateway")),(0,t.createElement)("div",{className:"ai-studio-workflow-meta"},(0,t.createElement)("input",{className:"ai-studio-input",value:Ke,placeholder:(0,o.__)("Version note (optional)","ai-gateway"),onChange:e=>Ze(e.target.value)}),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>{vt(ze,{saveVersion:!0,note:Ke}),Ze("")}},(0,o.__)("Save version","ai-gateway")))),Qe.length>0&&(0,t.createElement)("div",{className:"ai-studio-workflow-versions"},Qe.map((e,a)=>(0,t.createElement)("div",{key:a,className:"ai-studio-workflow-version"},(0,t.createElement)("div",null,(0,t.createElement)("div",{className:"ai-studio-workflow-version-title"},"Version "+(Qe.length-a)),(0,t.createElement)("div",{className:"ai-studio-workflow-version-meta"},e.note||(0,o.__)("No note","ai-gateway")," · ",e.saved_at?new Date(e.saved_at).toLocaleString():"")),(0,t.createElement)("button",{className:"ai-studio-button secondary tiny",onClick:()=>{const t=u(e.workflow||[]);Ve(t),vt(t)}},(0,o.__)("Restore","ai-gateway"))))),(0,t.createElement)("div",{className:"ai-studio-workflow-canvas",style:{width:_t.width,height:_t.height}},(0,t.createElement)("svg",{className:"ai-studio-workflow-lines",width:_t.width,height:_t.height},ze.map((e,a)=>{const i=ze[a+1];if(!i)return null;const n=(e.x||0)+240,s=(e.y||0)+70,o=i.x||0,l=(i.y||0)+70;return(0,t.createElement)("line",{key:`${e.id}-line`,x1:n,y1:s,x2:o,y2:l,stroke:"#334155",strokeWidth:"2"})})),ze.map((a,i)=>(0,t.createElement)("div",{key:a.id,className:"ai-studio-workflow-node",style:{left:a.x,top:a.y,width:240}},(0,t.createElement)("div",{className:"ai-studio-workflow-node-header",onMouseDown:e=>((e,t)=>{if(0!==e.button)return;e.preventDefault();const a=e.currentTarget.closest(".ai-studio-workflow-canvas");if(!a)return;const i=a.getBoundingClientRect();tt({id:t.id,offsetX:e.clientX-i.left-(t.x||0),offsetY:e.clientY-i.top-(t.y||0)})})(e,a)},(0,t.createElement)("span",null,`#${i+1} ${a.type}`),(0,t.createElement)("div",{className:"ai-studio-workflow-node-actions"},(0,t.createElement)("button",{className:"ai-studio-button secondary tiny",onClick:()=>Et(i,-1)},(0,o.__)("Up","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary tiny",onClick:()=>Et(i,1)},(0,o.__)("Down","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary tiny",onClick:()=>{const e=ze.filter((e,t)=>t!==i);Ve(e),vt(e)}},(0,o.__)("Remove","ai-gateway")))),(0,t.createElement)("div",{className:"ai-studio-workflow-node-body"},"run_agent"===a.type&&(0,t.createElement)("select",{className:"ai-studio-select",value:a.agentId||"",onChange:e=>{const t=[...ze];t[i]={...a,agentId:Number(e.target.value)},Ve(t),vt(t)}},(0,t.createElement)("option",{value:""},(0,o.__)("Select agent","ai-gateway")),e.map(e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.name))),"run_agent"===a.type&&(0,t.createElement)("textarea",{className:"ai-studio-textarea editor",rows:"3",placeholder:(0,o.__)("Prompt (optional)","ai-gateway"),value:a.prompt||"",onChange:e=>{const t=[...ze];t[i]={...a,prompt:e.target.value},Ve(t),vt(t)}}),("create_draft"===a.type||"update_draft"===a.type)&&(0,t.createElement)("select",{className:"ai-studio-select",value:a.postType||"article",onChange:e=>{const t=[...ze];t[i]={...a,postType:e.target.value},Ve(t),vt(t)}},(0,t.createElement)("option",{value:"article"},(0,o.__)("Article","ai-gateway")),(0,t.createElement)("option",{value:"page"},(0,o.__)("Page","ai-gateway"))),"create_draft"===a.type&&(0,t.createElement)("input",{className:"ai-studio-input",value:a.title||"",placeholder:(0,o.__)("Draft title","ai-gateway"),onChange:e=>{const t=[...ze];t[i]={...a,title:e.target.value},Ve(t),vt(t)}}),"update_draft"===a.type&&(0,t.createElement)("input",{className:"ai-studio-input",value:a.postId||"",placeholder:(0,o.__)("Draft ID","ai-gateway"),onChange:e=>{const t=[...ze];t[i]={...a,postId:Number(e.target.value)},Ve(t),vt(t)}}))))),(0,t.createElement)("div",{className:"ai-studio-workflow-actions"},(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>ht({type:"run_agent",agentId:i||0})},(0,o.__)("Add Agent","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>ht({type:"create_draft",postType:"article",title:""})},(0,o.__)("Add Draft","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>ht({type:"update_draft",postType:"article",postId:0})},(0,o.__)("Update Draft","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>ht({type:"insert_image"})},(0,o.__)("Insert Image","ai-gateway"))),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{if(ze.length){Je("Running...");try{let e="";for(const t of ze){if("run_agent"===t.type){const a=t.prompt||m,i=await s()({path:"/ai/v1/run",method:"POST",data:{agent_id:t.agentId,instruction:a,inputs:w}});e=i?.mcp_response||i?.ollama_response||""}if("create_draft"===t.type){const a="page"===t.postType?"/wp/v2/pages":"/wp/v2/posts",i=await s()({path:a,method:"POST",data:{title:t.title||"Draft",content:e,status:"draft"}});if(Ge(i?.id||0),i?.id){const e=`${t.title||"Draft"} (ID: ${i.id})`;await s()({path:`${a}/${i.id}`,method:"POST",data:{title:e}}),Xe("page"===t.postType?`${window.location.origin}/?page_id=${i.id}&preview=true`:`${window.location.origin}/?p=${i.id}&preview=true`)}}if("update_draft"===t.type&&t.postId){const a="page"===t.postType?`/wp/v2/pages/${t.postId}`:`/wp/v2/posts/${t.postId}`;await s()({path:a,method:"POST",data:{content:e}})}"insert_image"===t.type&&K?.url&&(e+=`\n\n![image](${K.url})`)}Je("Done")}catch(e){nt(e.message||"Workflow failed."),Je("Failed")}}else nt("No workflow nodes.")},disabled:C},(0,o.__)("Run workflow","ai-gateway")),qe&&(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>I("preview")},(0,o.__)("Open preview","ai-gateway")),Ye&&(0,t.createElement)("div",{className:"ai-studio-sidebar-empty"},Ye)):"preview"===A?(0,t.createElement)("div",{className:"ai-studio-workspace-panel preview"},(0,t.createElement)("h3",null,(0,o.__)("Preview","ai-gateway")),qe?(0,t.createElement)("iframe",{title:"Preview",className:"ai-studio-iframe",src:qe}):(0,t.createElement)("div",{className:"ai-studio-workspace-empty"},(0,o.__)("No preview yet.","ai-gateway"))):(0,t.createElement)("div",{className:"ai-studio-workspace-empty"},(0,o.__)("Workspace","ai-gateway"))),O&&(0,t.createElement)("div",{className:"ai-studio-modal"},(0,t.createElement)("div",{className:"ai-studio-modal-card"},(0,t.createElement)("h3",null,(0,o.__)("Conversation actions","ai-gateway")),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Rename","ai-gateway")),(0,t.createElement)("input",{value:b.find(e=>e.id===O)?.name||"",onChange:e=>{const t=e.target.value;N(e=>e.map(e=>e.id===O?{...e,name:t}:e))}})),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Move to project","ai-gateway")),(0,t.createElement)("select",{className:"ai-studio-select",value:M,onChange:e=>U(Number(e.target.value))},(0,t.createElement)("option",{value:"0"},(0,o.__)("Select project","ai-gateway")),_.map(e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.name)))),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Or create project","ai-gateway")),(0,t.createElement)("input",{value:F,onChange:e=>R(e.target.value),placeholder:(0,o.__)("New project name","ai-gateway")})),(0,t.createElement)("div",{className:"ai-studio-modal-actions"},(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{const e=b.find(e=>e.id===O)?.name||"";await s()({path:`/ai/v1/conversations/${O}`,method:"PUT",data:{name:e}}),j(null)}},(0,o.__)("Rename","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{await(async e=>{let t=M;if(!t&&""!==F.trim()){const e=await s()({path:"/ai/v1/projects",method:"POST",data:{name:F.trim()}});h(t=>[e,...t]),t=e.id}t&&(await s()({path:`/ai/v1/conversations/${e}`,method:"PUT",data:{project_id:t}}),N(t=>t.filter(t=>t.id!==e)),k===e&&S(0))})(O),j(null)}},(0,o.__)("Move","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{await(async e=>{await s()({path:`/ai/v1/conversations/${e}/archive`,method:"POST"}),N(t=>t.filter(t=>t.id!==e)),k===e&&S(0)})(O),j(null)}},(0,o.__)("Archive","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{await(async e=>{await s()({path:`/ai/v1/conversations/${e}`,method:"DELETE"}),N(t=>t.filter(t=>t.id!==e)),k===e&&S(0)})(O),j(null)}},(0,o.__)("Delete","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>j(null)},(0,o.__)("Cancel","ai-gateway"))))),re&&(0,t.createElement)("div",{className:"ai-studio-modal"},(0,t.createElement)("div",{className:"ai-studio-modal-card"},(0,t.createElement)("h3",null,(0,o.__)("Project actions","ai-gateway")),(0,t.createElement)("label",{className:"ai-studio-field"},(0,t.createElement)("span",null,(0,o.__)("Rename","ai-gateway")),(0,t.createElement)("input",{value:de,onChange:e=>ue(e.target.value)})),(0,t.createElement)("div",{className:"ai-studio-modal-actions"},(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:async()=>{await s()({path:`/ai/v1/projects/${E}`,method:"PUT",data:{name:de}}),h(e=>e.map(e=>e.id===E?{...e,name:de}:e)),ce(!1)}},(0,o.__)("Rename","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button",onClick:async()=>{await s()({path:`/ai/v1/projects/${E}`,method:"DELETE"}),h(e=>e.filter(e=>e.id!==E)),f(0),ce(!1)}},(0,o.__)("Delete","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-button secondary",onClick:()=>ce(!1)},(0,o.__)("Cancel","ai-gateway"))))),D&&(0,t.createElement)("div",{className:"ai-studio-modal"},(0,t.createElement)("div",{className:"ai-studio-modal-card large"},(0,t.createElement)("div",{className:"ai-studio-modal-header"},(0,t.createElement)("h3",null,(0,o.__)("Settings","ai-gateway")),(0,t.createElement)("button",{className:"ai-studio-icon-button",onClick:()=>x(!1)},"X")),(0,t.createElement)("iframe",{title:"Settings",className:"ai-studio-iframe",src:`${lt}admin.php?page=ai-gateway-settings&studio=1`}))))}(0,a.registerBlockType)("ai-gateway/studio",{title:(0,o.__)("AI Studio","ai-gateway"),icon:"format-chat",category:"widgets",edit(){const e=(0,i.useBlockProps)({className:"ai-studio-block-placeholder"});return(0,t.createElement)("div",{...e},(0,o.__)("AI Studio App","ai-gateway"))},save(){const e=i.useBlockProps.save({className:"ai-studio-app"});return(0,t.createElement)("div",{...e})}});const p=()=>{const e=document.querySelectorAll(".ai-studio-app");e.length&&e.forEach(e=>{window.wp.element.render((0,t.createElement)(m,null),e)})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",p):p()})();